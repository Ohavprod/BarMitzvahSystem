<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>מערכת ניהול אירועי בר מצווה</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.auth0.com/js/auth0-spa-js/2.0/auth0-spa-js.production.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#1e3a8a',
                        secondary: '#374151',
                        accent: '#059669'
                    },
                    fontFamily: {
                        'rounded': ['ui-rounded', 'system-ui', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Varela+Round&family=Nunito:wght@300;400;500;600;700;800&display=swap');
        body { 
            font-family: 'Nunito', 'Varela Round', sans-serif; 
            font-weight: 500;
        }
        .gradient-header { background: linear-gradient(135deg, #1e3a8a 0%, #3730a3 100%); }
        .card-professional { 
            transition: all 0.3s ease; 
            border-left: 4px solid transparent;
        }
        .card-professional:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
            border-left-color: #1e3a8a;
        }
        .card-gradient-1 { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card-gradient-2 { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .card-gradient-3 { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .card-gradient-4 { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
        .card-gradient-5 { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
        .card-gradient-6 { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); }
        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
        }
        .sidebar {
            transform: translateX(100%);
            transition: transform 0.3s ease-in-out;
        }
        .sidebar.open {
            transform: translateX(0);
        }
        .song-card {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-left: 4px solid #3b82f6;
        }
        .song-card:nth-child(even) {
            background: linear-gradient(135deg, #fef7ff 0%, #f3e8ff 100%);
            border-left-color: #8b5cf6;
        }
        .song-card:nth-child(3n) {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border-left-color: #10b981;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Sidebar -->
    <div id="sidebar" class="sidebar fixed top-0 right-0 h-full w-80 bg-white shadow-2xl z-50 overflow-y-auto">
        <div class="p-6 border-b border-gray-200 bg-gradient-to-l from-blue-600 to-purple-600 text-white">
            <div class="flex justify-between items-center">
                <h2 class="text-xl font-bold">תפריט ניהול</h2>
                <button id="closeSidebar" class="text-white hover:text-gray-200 text-2xl font-bold p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-all">
                    ×
                </button>
            </div>
        </div>
        
        <!-- Login Section -->
        <div class="p-4 border-b border-gray-200">
            <div id="loginSection">
                <button id="loginBtn" class="w-full bg-blue-600 text-white px-3 py-2 rounded-2xl text-sm font-medium hover:bg-blue-700 transition-colors shadow-md flex items-center justify-center">
                    <span class="ml-2">🔐</span>
                    <span>כניסה למנהל</span>
                </button>
            </div>
            <div id="userInfo" class="hidden">
                <div class="bg-green-50 p-4 rounded-2xl border border-green-200">
                    <div class="flex items-center justify-between mb-3">
                        <div>
                            <div class="text-green-800 font-medium">מנהל המערכת</div>
                            <div class="text-green-600 text-sm">גישה מלאה</div>
                        </div>
                        <span class="text-green-500 text-2xl">✅</span>
                    </div>
                    <div class="space-y-2">
                        <button onclick="refreshDataFromCMS()" class="w-full bg-blue-600 text-white px-4 py-2 rounded-2xl text-sm hover:bg-blue-700 transition-colors">
                            🔄 רענן נתונים
                        </button>
                        <button onclick="exportToCMSFormat()" class="w-full bg-green-600 text-white px-4 py-2 rounded-2xl text-sm hover:bg-green-700 transition-colors">
                            📥 ייצא נתונים
                        </button>
                        <div class="mt-3 p-2 bg-yellow-50 rounded-2xl border border-yellow-200">
                            <div class="text-xs text-yellow-700 font-medium">💾 שמירה אוטומטית</div>
                            <div class="text-xs text-yellow-600">כל השינויים נשמרים אוטומטית</div>
                        </div>
                        <button id="logoutBtn" class="w-full bg-red-600 text-white px-4 py-2 rounded-2xl text-sm hover:bg-red-700 transition-colors">
                            יציאה
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <nav class="p-4">
            <ul class="space-y-2">
                <li>
                    <button onclick="showPage('events')" class="nav-item w-full text-right p-4 rounded-2xl hover:bg-blue-50 transition-all flex items-center">
                        <span class="text-blue-500 ml-3 text-xl">📅</span>
                        <span class="font-medium">אירועים</span>
                    </button>
                </li>
                <li>
                    <button onclick="showPage('prayer-songs')" class="nav-item w-full text-right p-4 rounded-2xl hover:bg-purple-50 transition-all flex items-center">
                        <span class="text-purple-500 ml-3 text-xl">🎵</span>
                        <span class="font-medium">שירי תפילה</span>
                    </button>
                </li>
                <li>
                    <button onclick="showPage('meal-songs')" class="nav-item w-full text-right p-4 rounded-2xl hover:bg-green-50 transition-all flex items-center">
                        <span class="text-green-500 ml-3 text-xl">🍽️</span>
                        <span class="font-medium">שירי סעודה</span>
                    </button>
                </li>
                <li id="adminSection" class="border-t border-gray-200 pt-4 mt-4 hidden">
                    <div class="text-gray-500 text-sm font-medium mb-2 px-4">אזור אישי</div>
                    <button onclick="showPage('admin')" class="nav-item w-full text-right p-4 rounded-2xl hover:bg-orange-50 transition-all flex items-center">
                        <span class="text-orange-500 ml-3 text-xl">👤</span>
                        <span class="font-medium">ניהול תלמידים</span>
                    </button>
                </li>
                <li id="equipmentSection" class="hidden">
                    <button onclick="showPage('equipment')" class="nav-item w-full text-right p-4 rounded-2xl hover:bg-red-50 transition-all flex items-center">
                        <span class="text-red-500 ml-3 text-xl">🎤</span>
                        <span class="font-medium">צ'קליסט ציוד</span>
                    </button>
                </li>
                <li id="paymentsSection" class="hidden">
                    <button onclick="showPage('payments')" class="nav-item w-full text-right p-4 rounded-2xl hover:bg-emerald-50 transition-all flex items-center">
                        <span class="text-emerald-500 ml-3 text-xl">💰</span>
                        <span class="font-medium">מעקב תשלומים</span>
                    </button>
                </li>
                <li id="songsLibrarySection" class="hidden">
                    <button onclick="showPage('songs-library')" class="nav-item w-full text-right p-4 rounded-2xl hover:bg-indigo-50 transition-all flex items-center">
                        <span class="text-indigo-500 ml-3 text-xl">🎼</span>
                        <span class="font-medium">ספריית שירים</span>
                    </button>
                </li>
                <li id="importantLinksSection" class="hidden">
                    <button onclick="showPage('important-links')" class="nav-item w-full text-right p-4 rounded-2xl hover:bg-cyan-50 transition-all flex items-center">
                        <span class="text-cyan-500 ml-3 text-xl">🔗</span>
                        <span class="font-medium">קישורים חשובים</span>
                    </button>
                </li>
            </ul>
        </nav>
    </div>

    <!-- Overlay -->
    <div id="overlay" class="hidden fixed inset-0 bg-black bg-opacity-50 z-40" onclick="closeSidebar()"></div>

    <!-- Header -->
    <header class="gradient-header text-white shadow-lg">
        <div class="container mx-auto px-4 sm:px-6 py-4 sm:py-6">
            <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center">
                <div class="mb-4 sm:mb-0">
                    <h1 class="text-2xl sm:text-3xl font-bold mb-1">מערכת ניהול אירועי בר מצווה</h1>
                    <p class="text-blue-100 text-sm sm:text-lg">ניהול תפילה • לימוד • שירים ופיוטים</p>
                </div>
                <div class="flex items-center space-x-3 space-x-reverse">
                    <button id="menuBtn" class="bg-white bg-opacity-20 text-white px-4 py-2 rounded-2xl hover:bg-opacity-30 transition-all flex items-center">
                        <span class="ml-2">☰</span>
                        <span>תפריט</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 sm:px-6 py-6 sm:py-8">
        <!-- Events Page -->
        <div id="events-page" class="page">
            <div class="bg-white rounded-3xl shadow-lg border border-gray-100">
                <div class="bg-gradient-to-l from-blue-50 to-indigo-50 border-b border-gray-200 p-4 sm:p-6 rounded-t-3xl">
                    <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center">
                        <div class="mb-4 sm:mb-0">
                            <h2 class="text-xl sm:text-2xl font-bold text-gray-800 mb-1">אירועים קרובים</h2>
                            <p class="text-gray-600 text-sm sm:text-base">זמני הגעת האורחים וזמני תחילת האירוע</p>
                        </div>
                        <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-3 sm:space-x-reverse">
                            <select id="packageFilter" class="border border-gray-300 rounded-2xl px-3 sm:px-4 py-2 text-gray-700 bg-white shadow-sm text-sm sm:text-base">
                                <option value="">כל החבילות</option>
                                <option value="חבילה בסיסית">חבילה בסיסית</option>
                                <option value="חבילה חגיגית">חבילה חגיגית</option>
                                <option value="חבילת הכל כלול">חבילת הכל כלול</option>
                            </select>
                            <select id="keyboardistFilter" class="border border-gray-300 rounded-2xl px-3 sm:px-4 py-2 text-gray-700 bg-white shadow-sm text-sm sm:text-base">
                                <option value="">כל האירועים</option>
                                <option value="true">עם קלידן</option>
                                <option value="false">ללא קלידן</option>
                            </select>
                            <select id="drummersFilter" class="border border-gray-300 rounded-2xl px-3 sm:px-4 py-2 text-gray-700 bg-white shadow-sm text-sm sm:text-base">
                                <option value="">כל האירועים</option>
                                <option value="true">עם מתופפים</option>
                                <option value="false">ללא מתופפים</option>
                            </select>
                            <select id="dateFilter" class="border border-gray-300 rounded-2xl px-3 sm:px-4 py-2 text-gray-700 bg-white shadow-sm text-sm sm:text-base">
                                <option value="">כל האירועים</option>
                                <option value="future">אירועים עתידיים</option>
                            </select>
                            <button id="addEventBtn" class="bg-blue-600 text-white px-4 sm:px-6 py-2 rounded-2xl hover:bg-blue-700 transition-colors font-medium shadow-md text-sm sm:text-base hidden" onclick="addNewEvent()">
                                ➕ הוסף אירוע
                            </button>
                        </div>
                    </div>
                </div>

                <div class="p-4 sm:p-6 space-y-4 sm:space-y-6" id="eventsContainer">
                    <!-- Event items will be populated here -->
                </div>
            </div>
        </div>

        <!-- Prayer Songs Page -->
        <div id="prayer-songs-page" class="page hidden">
            <div class="bg-white rounded-3xl shadow-lg border border-gray-100">
                <div class="bg-gradient-to-l from-purple-50 to-pink-50 border-b border-gray-200 p-4 sm:p-6 rounded-t-3xl">
                    <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center">
                        <div class="mb-4 sm:mb-0">
                            <h2 class="text-xl sm:text-2xl font-bold text-gray-800 mb-1">שירי תפילה</h2>
                            <p class="text-gray-600 text-sm sm:text-base">רשימת השירים לחלק התפילה בבר המצווה</p>
                        </div>
                        <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-3 sm:space-x-reverse">
                            <select id="prayerViewFilter" class="border border-gray-300 rounded-2xl px-3 sm:px-4 py-2 text-gray-700 bg-white shadow-sm text-sm sm:text-base">
                                <option value="list">תצוגת רשימה</option>
                                <option value="categories">תצוגת קטגוריות</option>
                            </select>
                            <select id="prayerCategoryFilter" class="border border-gray-300 rounded-2xl px-3 sm:px-4 py-2 text-gray-700 bg-white shadow-sm text-sm sm:text-base">
                                <option value="">כל הקטגוריות</option>
                                <option value="תפילה">תפילה</option>
                                <option value="כניסה">כניסה</option>
                            </select>
                            <button id="managePrayerCategoriesBtn" class="bg-purple-600 text-white px-4 sm:px-6 py-2 rounded-2xl hover:bg-purple-700 transition-colors font-medium shadow-md text-sm sm:text-base hidden" onclick="managePrayerCategories()">
                                ⚙️ נהל קטגוריות
                            </button>
                        </div>
                    </div>
                </div>
                <div class="p-4 sm:p-6 space-y-4" id="prayerSongsContainer">
                    <!-- Prayer songs will be populated here -->
                </div>
            </div>
        </div>

        <!-- Meal Songs Page -->
        <div id="meal-songs-page" class="page hidden">
            <div class="bg-white rounded-3xl shadow-lg border border-gray-100">
                <div class="bg-gradient-to-l from-green-50 to-emerald-50 border-b border-gray-200 p-4 sm:p-6 rounded-t-3xl">
                    <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center">
                        <div class="mb-4 sm:mb-0">
                            <h2 class="text-xl sm:text-2xl font-bold text-gray-800 mb-1">שירי סעודה</h2>
                            <p class="text-gray-600 text-sm sm:text-base">רשימת השירים לחלק הסעודה בבר המצווה</p>
                        </div>
                        <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-3 sm:space-x-reverse">
                            <select id="mealViewFilter" class="border border-gray-300 rounded-2xl px-3 sm:px-4 py-2 text-gray-700 bg-white shadow-sm text-sm sm:text-base">
                                <option value="list">תצוגת רשימה</option>
                                <option value="categories">תצוגת קטגוריות</option>
                            </select>
                            <select id="mealCategoryFilter" class="border border-gray-300 rounded-2xl px-3 sm:px-4 py-2 text-gray-700 bg-white shadow-sm text-sm sm:text-base">
                                <option value="">כל הקטגוריות</option>
                                <option value="סעודה">סעודה</option>
                                <option value="ברכות">ברכות</option>
                                <option value="הבדלה">הבדלה</option>
                            </select>
                            <button id="manageMealCategoriesBtn" class="bg-green-600 text-white px-4 sm:px-6 py-2 rounded-2xl hover:bg-green-700 transition-colors font-medium shadow-md text-sm sm:text-base hidden" onclick="manageMealCategories()">
                                ⚙️ נהל קטגוריות
                            </button>
                        </div>
                    </div>
                </div>
                <div class="p-4 sm:p-6 space-y-4" id="mealSongsContainer">
                    <!-- Meal songs will be populated here -->
                </div>
            </div>
        </div>

        <!-- Admin Page -->
        <div id="admin-page" class="page hidden">
            <div class="bg-white rounded-3xl shadow-lg border border-gray-100">
                <div class="bg-gradient-to-l from-orange-50 to-red-50 border-b border-gray-200 p-4 sm:p-6 rounded-t-3xl">
                    <h2 class="text-xl sm:text-2xl font-bold text-gray-800 mb-1">ניהול תלמידים</h2>
                    <p class="text-gray-600 text-sm sm:text-base">מעקב אחר התקדמות התלמידים</p>
                </div>
                <div class="divide-y divide-gray-200" id="studentsContainer">
                    <!-- Student items will be populated here -->
                </div>
            </div>
        </div>

        <!-- Equipment Page -->
        <div id="equipment-page" class="page hidden">
            <div class="bg-white rounded-3xl shadow-lg border border-gray-100">
                <div class="bg-gradient-to-l from-red-50 to-pink-50 border-b border-gray-200 p-4 sm:p-6 rounded-t-3xl">
                    <h2 class="text-xl sm:text-2xl font-bold text-gray-800 mb-1">צ'קליסט ציוד</h2>
                    <p class="text-gray-600 text-sm sm:text-base">רשימת ציוד נדרש לאירוע</p>
                </div>
                <div class="p-4 sm:p-6" id="equipmentContainer">
                    <!-- Equipment checklist will be populated here -->
                </div>
            </div>
        </div>

        <!-- Payments Page -->
        <div id="payments-page" class="page hidden">
            <div class="bg-white rounded-3xl shadow-lg border border-gray-100">
                <div class="bg-gradient-to-l from-emerald-50 to-teal-50 border-b border-gray-200 p-4 sm:p-6 rounded-t-3xl">
                    <h2 class="text-xl sm:text-2xl font-bold text-gray-800 mb-1">מעקב תשלומים</h2>
                    <p class="text-gray-600 text-sm sm:text-base">מעקב אחר תשלומים לקלידן, מתופפים וקבלות</p>
                </div>
                <div class="p-4 sm:p-6" id="paymentsContainer">
                    <!-- Payments tracking will be populated here -->
                </div>
            </div>
        </div>

        <!-- Songs Library Page -->
        <div id="songs-library-page" class="page hidden">
            <div class="bg-white rounded-3xl shadow-lg border border-gray-100">
                <div class="bg-gradient-to-l from-indigo-50 to-purple-50 border-b border-gray-200 p-4 sm:p-6 rounded-t-3xl">
                    <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center">
                        <div class="mb-4 sm:mb-0">
                            <h2 class="text-xl sm:text-2xl font-bold text-gray-800 mb-1">ספריית שירים</h2>
                            <p class="text-gray-600 text-sm sm:text-base">כל השירים והפיוטים במערכת</p>
                        </div>
                        <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-3 sm:space-x-reverse">
                            <input type="text" id="songSearch" placeholder="חיפוש שיר..." class="border border-gray-300 rounded-2xl px-3 sm:px-4 py-2 text-gray-700 bg-white shadow-sm text-sm sm:text-base">
                            <button id="addSongBtn" class="bg-blue-600 text-white px-4 sm:px-6 py-2 rounded-2xl hover:bg-blue-700 transition-colors font-medium shadow-md text-sm sm:text-base hidden" onclick="addNewSong()">
                                ➕ הוסף שיר
                            </button>
                        </div>
                    </div>
                </div>
                <div class="p-4 sm:p-6" id="songsLibraryContainer">
                    <!-- Songs library will be populated here -->
                </div>
            </div>
        </div>

        <!-- Important Links Page -->
        <div id="important-links-page" class="page hidden">
            <div class="bg-white rounded-3xl shadow-lg border border-gray-100">
                <div class="bg-gradient-to-l from-cyan-50 to-blue-50 border-b border-gray-200 p-4 sm:p-6 rounded-t-3xl">
                    <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center">
                        <div class="mb-4 sm:mb-0">
                            <h2 class="text-xl sm:text-2xl font-bold text-gray-800 mb-1">קישורים חשובים</h2>
                            <p class="text-gray-600 text-sm sm:text-base">קישורים מהירים לביצוע פעולות נפוצות</p>
                        </div>
                        <button id="addLinkBtn" class="bg-cyan-600 text-white px-4 sm:px-6 py-2 rounded-2xl hover:bg-cyan-700 transition-colors font-medium shadow-md text-sm sm:text-base hidden" onclick="addNewLink()">
                            ➕ הוסף קישור
                        </button>
                    </div>
                </div>
                <div class="p-4 sm:p-6" id="importantLinksContainer">
                    <!-- Important links will be populated here -->
                </div>
            </div>
        </div>
    </main>

    <!-- Event Modal -->
    <div id="eventModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-2 sm:p-4">
        <div class="bg-white rounded-3xl shadow-xl max-w-4xl w-full max-h-[95vh] sm:max-h-[90vh] overflow-y-auto">
            <div class="border-b border-gray-200 p-3 sm:p-6 sticky top-0 bg-white rounded-t-3xl">
                <div class="flex justify-between items-center">
                    <h3 class="text-base sm:text-lg md:text-xl font-bold text-gray-800" id="modalTitle">פרטי אירוע</h3>
                    <button id="closeModal" class="text-gray-400 hover:text-gray-600 text-xl sm:text-2xl font-bold p-1 rounded-full hover:bg-gray-100 transition-all">×</button>
                </div>
            </div>
            <div class="p-3 sm:p-6" id="modalContent">
                <!-- Modal content will be populated here -->
            </div>
        </div>
    </div>

    <script>
        // Sample data
        const events = [
            {
                id: 1,
                name: "דוד כהן",
                date: "2024-01-15",
                time: "10:00",
                guestArrivalTime: "09:30",
                eventStartTime: "10:00",
                location: "בית כנסת הגדול, תל אביב",
                wazeLink: "https://waze.com/ul?q=בית כנסת הגדול תל אביב",
                package: "חבילה חגיגית",
                keyboardist: true,
                drummers: 1,
                isStudent: true,
                price: 3500,
                parentPhone: "050-1234567",
                parentName: "משה כהן",
                notes: "נער מוכשר, מעדיף שירים מזרחיים",
                status: "confirmed",
                mediaLinks: {
                    photos: "https://photos.google.com/share/example1",
                    videos: "https://drive.google.com/folder/example1"
                }
            },
            {
                id: 2,
                name: "יוסי לוי",
                date: "2024-01-20",
                time: "11:00",
                guestArrivalTime: "10:30",
                eventStartTime: "11:00",
                location: "בית כנסת אור החיים, ירושלים",
                wazeLink: "https://waze.com/ul?q=בית כנסת אור החיים ירושלים",
                package: "חבילה בסיסית",
                keyboardist: false,
                drummers: 0,
                isStudent: false,
                price: 2000,
                parentPhone: "052-9876543",
                parentName: "אברהם לוי",
                notes: "משפחה מסורתית, שירים קלאסיים",
                status: "pending",
                mediaLinks: {
                    photos: "",
                    videos: ""
                }
            },
            {
                id: 3,
                name: "אבי רוזן",
                date: "2024-01-22",
                time: "09:00",
                guestArrivalTime: "08:30",
                eventStartTime: "09:00",
                location: "בית כנסת הרמב\"ם, חיפה",
                wazeLink: "https://waze.com/ul?q=בית כנסת הרמבם חיפה",
                package: "חבילת הכל כלול",
                keyboardist: true,
                drummers: 2,
                isStudent: true,
                price: 5000,
                parentPhone: "054-5555555",
                parentName: "רחל רוזן",
                notes: "אירוע גדול, 200 אורחים",
                status: "confirmed",
                mediaLinks: {
                    photos: "",
                    videos: ""
                }
            }
        ];

        const students = [
            {
                id: 1,
                name: "דוד כהן",
                eventDate: "2024-01-15",
                lessonsCompleted: 8,
                totalLessons: 12,
                nextLesson: "2024-01-10",
                phone: "050-1234567",
                progress: "מתקדם מצוין, מוכן לקריאה בתורה",
                parsha: "פרשת וירא",
                readingType: "עליית ראשון + מפטיר",
                hasRecording: true,
                recordingNotes: "הקלטה של הפרשה והפטרה",
                haftarah: "מלכים א יח:כ-לט",
                torahPortion: "בראשית כב:א-יט",
                specialNotes: "יודע לקרוא עם טעמים, קול יפה"
            },
            {
                id: 3,
                name: "אבי רוזן",
                eventDate: "2024-01-22",
                lessonsCompleted: 6,
                totalLessons: 15,
                nextLesson: "2024-01-12",
                phone: "054-5555555",
                progress: "צריך עבודה נוספת על הפטרה",
                parsha: "פרשת חיי שרה",
                readingType: "עליית ראשון בלבד",
                hasRecording: false,
                recordingNotes: "עדיין לא מוכן להקלטה",
                haftarah: "מלכים א א:א-לא",
                torahPortion: "בראשית כג:א-כ",
                specialNotes: "קושי בטעמים, צריך תרגול נוסף"
            }
        ];

        const prayerSongs = [
            {
                id: 1,
                name: "שמע ישראל",
                key: "Am",
                tempo: 120,
                transpose: 0,
                chords: "Am - F - C - G",
                lyrics: "שמע ישראל ה' אלוהינו ה' אחד\nברוך שם כבוד מלכותו לעולם ועד",
                category: "תפילה"
            },
            {
                id: 2,
                name: "ברכו",
                key: "Dm",
                tempo: 90,
                transpose: 2,
                chords: "Dm - Bb - F - C",
                lyrics: "ברכו את ה' המבורך\nברוך ה' המבורך לעולם ועד",
                category: "כניסה"
            },
            {
                id: 3,
                name: "יגדל",
                key: "G",
                tempo: 110,
                transpose: -1,
                chords: "G - Em - C - D",
                lyrics: "יגדל אלוהים חי ויש תהלל\nנמצא ואין עת אל מציאותו",
                category: "תפילה"
            },
            {
                id: 4,
                name: "אדון עולם",
                key: "C",
                tempo: 100,
                transpose: 3,
                chords: "C - Am - F - G",
                lyrics: "אדון עולם אשר מלך\nבטרם כל יציר נברא",
                category: "תפילה"
            },
            {
                id: 5,
                name: "לכה דודי",
                key: "Em",
                tempo: 85,
                transpose: 0,
                chords: "Em - C - G - D",
                lyrics: "לכה דודי לקראת כלה\nפני שבת נקבלה",
                category: "כניסה"
            }
        ];

        const mealSongs = [
            {
                id: 1,
                name: "שלום עליכם",
                key: "D",
                tempo: 95,
                transpose: 1,
                chords: "D - A - Bm - G",
                lyrics: "שלום עליכם מלאכי השרת\nמלאכי עליון",
                category: "סעודה"
            },
            {
                id: 2,
                name: "אשת חיל",
                key: "F",
                tempo: 80,
                transpose: -2,
                chords: "F - Dm - Bb - C",
                lyrics: "אשת חיל מי ימצא\nורחוק מפנינים מכרה",
                category: "סעודה"
            },
            {
                id: 3,
                name: "ברכת המזון",
                key: "A",
                tempo: 105,
                transpose: 4,
                chords: "A - F#m - D - E",
                lyrics: "ברוך אתה ה' אלוהינו מלך העולם\nהזן את העולם כולו",
                category: "ברכות"
            },
            {
                id: 4,
                name: "הבדלה",
                key: "Bm",
                tempo: 75,
                transpose: 0,
                chords: "Bm - G - D - A",
                lyrics: "הנה אל ישועתי אבטח ולא אפחד\nכי עזי וזמרת יה ה'",
                category: "הבדלה"
            }
        ];

        const equipment = [
            { id: 1, item: "מיקרופון אלחוטי", checked: false, category: "קול" },
            { id: 2, item: "מערכת הגברה", checked: false, category: "קול" },
            { id: 3, item: "קלידים", checked: false, category: "כלי נגינה" },
            { id: 4, item: "תופים", checked: false, category: "כלי נגינה" },
            { id: 5, item: "כבלים", checked: false, category: "טכני" },
            { id: 6, item: "מתאם חשמל", checked: false, category: "טכני" },
            { id: 7, item: "עמדת תווים", checked: false, category: "אביזרים" },
            { id: 8, item: "כיסא לקלידן", checked: false, category: "אביזרים" },
            { id: 9, item: "מחשב נייד", checked: false, category: "טכני" },
            { id: 10, item: "רמקולים", checked: false, category: "קול" }
        ];

        const payments = [
            { 
                id: 1, 
                eventName: "דוד כהן", 
                keyboardistPaid: true, 
                keyboardistAmount: 800,
                drummersPaid: false, 
                drummersAmount: 0,
                receiptIssued: true, 
                managerPaid: true,
                managerAmount: 1500
            },
            { 
                id: 2, 
                eventName: "יוסי לוי", 
                keyboardistPaid: false, 
                keyboardistAmount: 0,
                drummersPaid: false, 
                drummersAmount: 0,
                receiptIssued: false, 
                managerPaid: false,
                managerAmount: 0
            },
            { 
                id: 3, 
                eventName: "אבי רוזן", 
                keyboardistPaid: true, 
                keyboardistAmount: 1000,
                drummersPaid: true, 
                drummersAmount: 1200,
                receiptIssued: false, 
                managerPaid: true,
                managerAmount: 2000
            }
        ];

        // Important links data
        const importantLinks = [
            {
                id: 1,
                name: "יש חשבונית - הוצאת קבלה",
                url: "https://www.ishhashounit.co.il",
                description: "מערכת להוצאת קבלות ומעקב הכנסות",
                category: "כספים",
                icon: "🧾"
            },
            {
                id: 2,
                name: "יש חשבונית - הזמנה חדשה",
                url: "https://www.ishhashounit.co.il/new-order",
                description: "פתיחת הזמנה חדשה במערכת",
                category: "כספים",
                icon: "📝"
            },
            {
                id: 3,
                name: "Google Calendar",
                url: "https://calendar.google.com",
                description: "ניהול לוח שנה ותזמון אירועים",
                category: "ניהול זמן",
                icon: "📅"
            },
            {
                id: 4,
                name: "WhatsApp Web",
                url: "https://web.whatsapp.com",
                description: "שליחת הודעות ללקוחות",
                category: "תקשורת",
                icon: "📱"
            }
        ];

        // Extended songs library
        const songsLibrary = [
            ...prayerSongs.map(song => ({...song, category: "תפילה"})),
            ...mealSongs.map(song => ({...song, category: "סעודה"})),
            { id: 101, name: "עוד ישמע", key: "Em", tempo: 130, transpose: 0, chords: "Em - C - G - D", lyrics: "עוד ישמע בערי יהודה\nובחוצות ירושלים", category: "חתונה", youtubeLink: "https://youtube.com/watch?v=example1" },
            { id: 102, name: "אם אשכחך", key: "Am", tempo: 85, transpose: 2, chords: "Am - F - C - G", lyrics: "אם אשכחך ירושלים\nתשכח ימיני", category: "מזמורים", youtubeLink: "https://youtube.com/watch?v=example2" },
            { id: 103, name: "הבדלה מלודי", key: "D", tempo: 95, transpose: -1, chords: "D - A - Bm - G", lyrics: "הנה אל ישועתי\nאבטח ולא אפחד", category: "הבדלה", youtubeLink: "https://youtube.com/watch?v=example3" }
        ];

        let isLoggedIn = false;
        let currentPage = 'events';
        let filteredEvents = [...events];
        let eventStates = {}; // Track collapsed/expanded states
        let auth0Client = null;
        let user = null;

        // Auth0 Configuration - Replace with your actual Auth0 settings
        // To set up Auth0:
        // 1. Go to https://auth0.com and create an account
        // 2. Create a new Single Page Application
        // 3. In the application settings, add your Netlify domain to:
        //    - Allowed Callback URLs: https://your-site.netlify.app
        //    - Allowed Logout URLs: https://your-site.netlify.app
        //    - Allowed Web Origins: https://your-site.netlify.app
        // 4. Replace the values below with your Auth0 application details
        const auth0Config = {
            domain: 'dev-xq17rgh1xskeyxfa.us.auth0.com', // e.g., 'my-app.auth0.com'
            clientId: 'F4UbYRfwBHLlbkFCHUxu6UYs3dn3z2A4', // From your Auth0 application settings
            redirectUri: window.location.origin, // This will be your Netlify URL
        };

        // DOM Elements
        const loginBtn = document.getElementById('loginBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const userInfo = document.getElementById('userInfo');
        const loginSection = document.getElementById('loginSection');
        const eventsContainer = document.getElementById('eventsContainer');
        const studentsContainer = document.getElementById('studentsContainer');
        const eventModal = document.getElementById('eventModal');
        const closeModal = document.getElementById('closeModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalContent = document.getElementById('modalContent');
        const menuBtn = document.getElementById('menuBtn');
        const sidebar = document.getElementById('sidebar');
        const closeSidebarBtn = document.getElementById('closeSidebar');
        const overlay = document.getElementById('overlay');

        // Filter elements
        const packageFilter = document.getElementById('packageFilter');
        const keyboardistFilter = document.getElementById('keyboardistFilter');
        const drummersFilter = document.getElementById('drummersFilter');

        // Initialize Auth0
        async function initAuth0() {
            try {
                auth0Client = await auth0.createAuth0Client(auth0Config);
                
                // Check if user is returning from Auth0 login
                const query = window.location.search;
                if (query.includes('code=') && query.includes('state=')) {
                    await auth0Client.handleRedirectCallback();
                    window.history.replaceState({}, document.title, window.location.pathname);
                }
                
                // Check if user is authenticated
                const isAuthenticated = await auth0Client.isAuthenticated();
                if (isAuthenticated) {
                    user = await auth0Client.getUser();
                    login();
                }
            } catch (error) {
                console.error('Auth0 initialization error:', error);
                // Fallback to demo mode if Auth0 fails
                showAuthError();
            }
        }

        // Event Listeners
        loginBtn.addEventListener('click', loginWithAuth0);
        logoutBtn.addEventListener('click', logoutFromAuth0);
        closeModal.addEventListener('click', () => eventModal.classList.add('hidden'));
        menuBtn.addEventListener('click', openSidebar);
        closeSidebarBtn.addEventListener('click', closeSidebar);

        // Filter event listeners
        const dateFilter = document.getElementById('dateFilter');
        packageFilter.addEventListener('change', applyFilters);
        keyboardistFilter.addEventListener('change', applyFilters);
        drummersFilter.addEventListener('change', applyFilters);
        dateFilter.addEventListener('change', applyFilters);
        
        // Song view filters
        document.getElementById('prayerViewFilter').addEventListener('change', renderPrayerSongs);
        document.getElementById('prayerCategoryFilter').addEventListener('change', renderPrayerSongs);
        document.getElementById('mealViewFilter').addEventListener('change', renderMealSongs);
        document.getElementById('mealCategoryFilter').addEventListener('change', renderMealSongs);

        // Search functionality
        document.getElementById('songSearch').addEventListener('input', renderSongsLibrary);

        // Auth0 Functions
        async function loginWithAuth0() {
            if (!auth0Client) {
                showAuthError();
                return;
            }
            
            try {
                await auth0Client.loginWithRedirect({
                    authorizationParams: {
                        redirect_uri: window.location.origin
                    }
                });
            } catch (error) {
                console.error('Login error:', error);
                showAuthError();
            }
        }

        async function logoutFromAuth0() {
            if (!auth0Client) {
                logout();
                return;
            }
            
            try {
                await auth0Client.logout({
                    logoutParams: {
                        returnTo: window.location.origin
                    }
                });
            } catch (error) {
                console.error('Logout error:', error);
                logout();
            }
        }

        function showAuthError() {
            const loginBtn = document.getElementById('loginBtn');
            loginBtn.innerHTML = `
                <span class="ml-2">⚠️</span>
                <span>שגיאת אימות - מצב הדגמה</span>
            `;
            loginBtn.onclick = () => {
                if (confirm('האימות דרך Auth0 לא זמין כרגע. האם תרצה להמשיך במצב הדגמה?')) {
                    login();
                }
            };
        }

        // Functions
        function login() {
            isLoggedIn = true;
            loginSection.classList.add('hidden');
            userInfo.classList.remove('hidden');
            
            // Update user info display
            if (user) {
                const userInfoDiv = document.querySelector('#userInfo .bg-green-50');
                userInfoDiv.innerHTML = `
                    <div class="flex items-center justify-between mb-3">
                        <div>
                            <div class="text-green-800 font-medium">${user.name || user.email}</div>
                            <div class="text-green-600 text-sm">מנהל מאומת</div>
                        </div>
                        <span class="text-green-500 text-2xl">✅</span>
                    </div>
                    <div class="space-y-2">
                        <button onclick="refreshDataFromCMS()" class="w-full bg-blue-600 text-white px-4 py-2 rounded-2xl text-sm hover:bg-blue-700 transition-colors">
                            🔄 רענן נתונים
                        </button>
                        <button onclick="exportToCMSFormat()" class="w-full bg-green-600 text-white px-4 py-2 rounded-2xl text-sm hover:bg-green-700 transition-colors">
                            📥 ייצא נתונים
                        </button>
                        <div class="mt-3 p-2 bg-yellow-50 rounded-2xl border border-yellow-200">
                            <div class="text-xs text-yellow-700 font-medium">💾 שמירה אוטומטית</div>
                            <div class="text-xs text-yellow-600">כל השינויים נשמרים אוטומטית</div>
                        </div>
                        <button id="logoutBtn" class="w-full bg-red-600 text-white px-4 py-2 rounded-2xl text-sm hover:bg-red-700 transition-colors" onclick="logoutFromAuth0()">
                            יציאה
                        </button>
                    </div>
                `;
            }
            
            // Show admin sections
            document.getElementById('adminSection').classList.remove('hidden');
            document.getElementById('equipmentSection').classList.remove('hidden');
            document.getElementById('paymentsSection').classList.remove('hidden');
            document.getElementById('songsLibrarySection').classList.remove('hidden');
            document.getElementById('importantLinksSection').classList.remove('hidden');
            
            // Show add event button
            const addEventBtn = document.getElementById('addEventBtn');
            if (addEventBtn) {
                addEventBtn.classList.remove('hidden');
            }
            
            // Show add song button
            const addSongBtn = document.getElementById('addSongBtn');
            if (addSongBtn) {
                addSongBtn.classList.remove('hidden');
            }
            
            // Show add link button
            const addLinkBtn = document.getElementById('addLinkBtn');
            if (addLinkBtn) {
                addLinkBtn.classList.remove('hidden');
            }
            
            // Show category management buttons
            const managePrayerBtn = document.getElementById('managePrayerCategoriesBtn');
            if (managePrayerBtn) {
                managePrayerBtn.classList.remove('hidden');
            }
            
            const manageMealBtn = document.getElementById('manageMealCategoriesBtn');
            if (manageMealBtn) {
                manageMealBtn.classList.remove('hidden');
            }
            
            renderCurrentPage();
        }

        function logout() {
            isLoggedIn = false;
            user = null;
            loginSection.classList.remove('hidden');
            userInfo.classList.add('hidden');
            
            document.getElementById('adminSection').classList.add('hidden');
            document.getElementById('equipmentSection').classList.add('hidden');
            document.getElementById('paymentsSection').classList.add('hidden');
            document.getElementById('songsLibrarySection').classList.add('hidden');
            document.getElementById('importantLinksSection').classList.add('hidden');
            
            const addEventBtn = document.getElementById('addEventBtn');
            if (addEventBtn) {
                addEventBtn.classList.add('hidden');
            }
            
            const addSongBtn = document.getElementById('addSongBtn');
            if (addSongBtn) {
                addSongBtn.classList.add('hidden');
            }
            
            const addLinkBtn = document.getElementById('addLinkBtn');
            if (addLinkBtn) {
                addLinkBtn.classList.add('hidden');
            }
            
            // Hide category management buttons
            const managePrayerBtn = document.getElementById('managePrayerCategoriesBtn');
            if (managePrayerBtn) {
                managePrayerBtn.classList.add('hidden');
            }
            
            const manageMealBtn = document.getElementById('manageMealCategoriesBtn');
            if (manageMealBtn) {
                manageMealBtn.classList.add('hidden');
            }
            
            renderCurrentPage();
        }

        function openSidebar() {
            sidebar.classList.add('open');
            overlay.classList.remove('hidden');
        }

        function closeSidebar() {
            sidebar.classList.remove('open');
            overlay.classList.add('hidden');
        }

        function showPage(page) {
            document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
            document.getElementById(page + '-page').classList.remove('hidden');
            
            currentPage = page;
            renderCurrentPage();
            closeSidebar();
        }

        function renderCurrentPage() {
            switch(currentPage) {
                case 'events':
                    renderEvents();
                    break;
                case 'prayer-songs':
                    renderPrayerSongs();
                    break;
                case 'meal-songs':
                    renderMealSongs();
                    break;
                case 'admin':
                    if (isLoggedIn) renderStudents();
                    break;
                case 'equipment':
                    if (isLoggedIn) renderEquipment();
                    break;
                case 'payments':
                    if (isLoggedIn) renderPayments();
                    break;
                case 'songs-library':
                    if (isLoggedIn) renderSongsLibrary();
                    break;
                case 'important-links':
                    if (isLoggedIn) renderImportantLinks();
                    break;
            }
        }

        function applyFilters() {
            const packageValue = packageFilter.value;
            const keyboardistValue = keyboardistFilter.value;
            const drummersValue = drummersFilter.value;
            const dateValue = dateFilter.value;

            filteredEvents = events.filter(event => {
                let matches = true;

                // Date filter
                if (dateValue === 'future') {
                    const eventDate = new Date(event.date);
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);
                    if (eventDate < today) {
                        matches = false;
                    }
                }

                if (packageValue && event.package !== packageValue) {
                    matches = false;
                }

                if (keyboardistValue !== '') {
                    const hasKeyboardist = keyboardistValue === 'true';
                    if (event.keyboardist !== hasKeyboardist) {
                        matches = false;
                    }
                }

                if (drummersValue !== '') {
                    const hasDrummers = drummersValue === 'true';
                    if ((event.drummers > 0) !== hasDrummers) {
                        matches = false;
                    }
                }

                return matches;
            });

            renderEvents();
        }

        function renderEvents() {
            eventsContainer.innerHTML = filteredEvents.map((event, index) => {
                const eventDate = new Date(event.date);
                const formattedDate = eventDate.toLocaleDateString('he-IL', {
                    day: 'numeric',
                    month: 'long',
                    year: 'numeric'
                });

                const statusColors = {
                    'confirmed': 'bg-green-500',
                    'pending': 'bg-yellow-500'
                };

                const gradientClass = `card-gradient-${(index % 6) + 1}`;

                const isCollapsed = eventStates[event.id] !== 'expanded';
                
                return `
                    <div class="card-professional bg-white rounded-xl shadow-md hover:shadow-lg transition-all duration-300 overflow-hidden">
                        <div class="${gradientClass} p-2 text-white">
                            <div class="flex justify-between items-center">
                                <div class="flex items-center">
                                    <span class="status-indicator ${statusColors[event.status]} ml-2 bg-white bg-opacity-80"></span>
                                    <h3 class="text-xl font-bold cursor-pointer hover:opacity-80 transition-opacity px-2 py-1 rounded-lg hover:bg-white hover:bg-opacity-20" onclick="toggleEventCollapse(${event.id})">בר מצווה - ${event.name}</h3>
                                </div>
                                ${event.isStudent ? '<span class="bg-white bg-opacity-20 text-white px-2 py-1 rounded-full text-xs font-medium">תלמיד</span>' : ''}
                            </div>
                        </div>

                        ${!isCollapsed ? `
                        <div class="p-3">
                            <div class="grid grid-cols-1 gap-2 mb-3">
                                <div class="card-professional bg-gradient-to-br from-blue-500 to-indigo-600 text-white p-2 rounded-xl shadow-sm cursor-pointer hover:shadow-md transition-all" onclick="addToGoogleCalendar(${event.id})">
                                    <div class="flex items-center">
                                        <span class="text-lg ml-2">📅</span>
                                        <span class="font-bold text-sm">${formattedDate}</span>
                                    </div>
                                </div>
                                
                                <div class="card-professional bg-gradient-to-br from-purple-500 to-pink-500 text-white p-2 rounded-xl shadow-sm cursor-pointer hover:shadow-md transition-all" onclick="event.stopPropagation(); openWaze('${event.wazeLink}')">
                                    <div class="flex items-center">
                                        <span class="text-lg ml-2">📍</span>
                                        <span class="font-bold text-sm">${event.location}</span>
                                    </div>
                                </div>
                                
                                <div class="card-professional bg-gradient-to-br from-green-500 to-emerald-600 text-white p-2 rounded-xl shadow-sm">
                                    <div class="flex items-center">
                                        <span class="text-lg ml-2">⏰</span>
                                        <span class="font-bold text-sm">אורחים: ${event.guestArrivalTime || event.time} • תחילת אירוע: ${event.eventStartTime || event.time}</span>
                                    </div>
                                </div>
                            </div>
                            

                            
                            ${isLoggedIn ? `
                                <div class="flex flex-wrap gap-1 mb-2">
                                    <button onclick="event.stopPropagation(); openYeshInvoice()" class="bg-blue-600 text-white px-2 py-1 rounded-lg text-xs hover:bg-blue-700 transition-colors font-medium flex items-center">
                                        <span class="ml-1">🧾</span>
                                        <span>חשבונית</span>
                                    </button>
                                    <button onclick="event.stopPropagation(); sendWhatsAppToParent('${event.parentPhone}', '${event.parentName}', '${event.name}')" class="bg-green-600 text-white px-2 py-1 rounded-lg text-xs hover:bg-green-700 transition-colors font-medium flex items-center">
                                        <span class="ml-1">📱</span>
                                        <span>WhatsApp</span>
                                    </button>
                                    <button onclick="event.stopPropagation(); editEvent(${event.id})" class="bg-orange-600 text-white px-2 py-1 rounded-lg text-xs hover:bg-orange-700 transition-colors font-medium flex items-center">
                                        <span class="ml-1">✏️</span>
                                        <span>ערוך</span>
                                    </button>
                                    <button onclick="event.stopPropagation(); deleteEvent(${event.id})" class="bg-red-600 text-white px-2 py-1 rounded-lg text-xs hover:bg-red-700 transition-colors font-medium flex items-center">
                                        <span class="ml-1">🗑️</span>
                                        <span>מחק</span>
                                    </button>
                                </div>
                            ` : ''}
                            
                            <div class="flex items-center justify-center text-white font-medium text-sm bg-gradient-to-r from-blue-600 to-indigo-600 px-4 py-2 rounded-xl hover:from-blue-700 hover:to-indigo-700 transition-all shadow-md hover:shadow-lg cursor-pointer" onclick="openEventModal(${event.id})">
                                <span class="ml-2">←</span>
                                <span>פרטים נוספים</span>
                            </div>
                        </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }

        function renderPrayerSongs() {
            const container = document.getElementById('prayerSongsContainer');
            const viewType = document.getElementById('prayerViewFilter').value;
            const categoryFilter = document.getElementById('prayerCategoryFilter').value;
            
            let filteredSongs = prayerSongs;
            if (categoryFilter) {
                filteredSongs = prayerSongs.filter(song => song.category === categoryFilter);
            }
            
            if (viewType === 'categories') {
                const categories = [...new Set(filteredSongs.map(song => song.category))];
                container.innerHTML = categories.map(category => {
                    const categorySongs = filteredSongs.filter(song => song.category === category);
                    return `
                        <div class="mb-6">
                            <h3 class="text-lg font-bold text-gray-800 mb-3 pr-4">${category}</h3>
                            <div class="space-y-4">
                                ${categorySongs.map((song, index) => renderSongCard(song, index)).join('')}
                            </div>
                        </div>
                    `;
                }).join('');
            } else {
                container.innerHTML = filteredSongs.map((song, index) => renderSongCard(song, index)).join('');
            }
        }
        
        function renderSongCard(song, index) {
            const gradientClass = `card-gradient-${(index % 6) + 1}`;
            return `
                <div class="bg-white border border-gray-200 rounded-3xl shadow-lg hover:shadow-xl transition-all duration-300 overflow-hidden">
                    <div class="${gradientClass} p-4 text-white cursor-pointer" onclick="toggleMealSongDetails(${song.id})">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <span class="text-2xl ml-3">🎵</span>
                                <h3 class="text-lg font-bold">${song.name}</h3>
                            </div>
                            <div class="flex items-center space-x-2 space-x-reverse">
                                <span class="bg-white bg-opacity-20 text-white px-3 py-1 rounded-full text-xs font-medium">${song.category}</span>
                                <span id="arrow-${song.id}" class="text-white text-xl transition-transform duration-300">▼</span>
                            </div>
                        </div>
                    </div>

                    <div id="song-details-${song.id}" class="hidden p-4">
                        <div class="flex flex-wrap gap-2 mb-4">
                            <span class="bg-gradient-to-r from-blue-500 to-indigo-600 text-white px-4 py-2 rounded-2xl text-sm font-bold shadow-md flex items-center">
                                <span class="ml-2">🎵</span>
                                ${song.key}
                            </span>
                            <span class="bg-gradient-to-r from-green-500 to-emerald-600 text-white px-4 py-2 rounded-2xl text-sm font-bold shadow-md flex items-center">
                                <span class="ml-2">⏱️</span>
                                ${song.tempo}
                            </span>
                            <span class="bg-gradient-to-r from-purple-500 to-pink-600 text-white px-4 py-2 rounded-2xl text-sm font-bold shadow-md flex items-center">
                                <span class="ml-2">🎹</span>
                                ${song.transpose > 0 ? '+' : ''}${song.transpose}
                            </span>
                        </div>
                        
                        <div id="chords-${song.id}" class="bg-gray-50 p-4 rounded-2xl mb-3 border border-gray-200">
                            <div class="text-sm font-bold text-gray-700 mb-2 flex items-center justify-between cursor-pointer hover:bg-gray-100 transition-colors p-2 rounded-xl -m-2" onclick="toggleSongSection(${song.id}, 'chords')">
                                <span>🎸 אקורדים</span>
                                <span id="chords-arrow-${song.id}" class="text-gray-500 transition-transform duration-300">▼</span>
                            </div>
                            <div id="chords-content-${song.id}" class="hidden text-sm text-gray-600 font-mono bg-white p-3 rounded-xl border">${song.chords}</div>
                        </div>
                        
                        <div id="lyrics-${song.id}" class="bg-blue-50 p-4 rounded-2xl border border-blue-200">
                            <div class="text-sm font-bold text-blue-700 mb-2 flex items-center justify-between cursor-pointer hover:bg-blue-100 transition-colors p-2 rounded-xl -m-2" onclick="toggleSongSection(${song.id}, 'lyrics')">
                                <span>📝 מילים</span>
                                <span id="lyrics-arrow-${song.id}" class="text-blue-500 transition-transform duration-300">▼</span>
                            </div>
                            <div id="lyrics-content-${song.id}" class="hidden text-sm text-blue-600 whitespace-pre-line bg-white p-3 rounded-xl border border-blue-200">${song.lyrics}</div>
                        </div>
                        
                        ${isLoggedIn ? `
                            <div class="flex justify-center mt-4">
                                <button onclick="editSong(${song.id})" class="bg-blue-600 text-white px-4 py-2 rounded-2xl text-sm hover:bg-blue-700 transition-colors font-medium flex items-center">
                                    <span class="ml-1">✏️</span>
                                    <span>ערוך</span>
                                </button>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        function renderMealSongs() {
            const container = document.getElementById('mealSongsContainer');
            const viewType = document.getElementById('mealViewFilter').value;
            const categoryFilter = document.getElementById('mealCategoryFilter').value;
            
            let filteredSongs = mealSongs;
            if (categoryFilter) {
                filteredSongs = mealSongs.filter(song => song.category === categoryFilter);
            }
            
            if (viewType === 'categories') {
                const categories = [...new Set(filteredSongs.map(song => song.category))];
                container.innerHTML = categories.map(category => {
                    const categorySongs = filteredSongs.filter(song => song.category === category);
                    return `
                        <div class="mb-6">
                            <h3 class="text-lg font-bold text-gray-800 mb-3 pr-4">${category}</h3>
                            <div class="space-y-4">
                                ${categorySongs.map((song, index) => renderMealSongCard(song, index)).join('')}
                            </div>
                        </div>
                    `;
                }).join('');
            } else {
                container.innerHTML = filteredSongs.map((song, index) => renderMealSongCard(song, index)).join('');
            }
        }
        
        function renderMealSongCard(song, index) {
            const gradientClass = `card-gradient-${(index % 6) + 1}`;
            return `
                <div class="bg-white border border-gray-200 rounded-3xl shadow-lg hover:shadow-xl transition-all duration-300 overflow-hidden">
                    <div class="${gradientClass} p-4 text-white cursor-pointer" onclick="toggleMealSongDetails(${song.id})">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <span class="text-2xl ml-3">🍽️</span>
                                <h3 class="text-lg font-bold">${song.name}</h3>
                            </div>
                            <div class="flex items-center space-x-2 space-x-reverse">
                                <span class="bg-white bg-opacity-20 text-white px-3 py-1 rounded-full text-xs font-medium">${song.category}</span>
                                <span id="arrow-${song.id}" class="text-white text-xl transition-transform duration-300">▼</span>
                            </div>
                        </div>
                    </div>

                    <div id="song-details-${song.id}" class="hidden p-4">
                        <div class="flex flex-wrap gap-2 mb-4">
                            <span class="bg-gradient-to-r from-blue-500 to-indigo-600 text-white px-4 py-2 rounded-2xl text-sm font-bold shadow-md flex items-center">
                                <span class="ml-2">🎵</span>
                                ${song.key}
                            </span>
                            <span class="bg-gradient-to-r from-green-500 to-emerald-600 text-white px-4 py-2 rounded-2xl text-sm font-bold shadow-md flex items-center">
                                <span class="ml-2">⏱️</span>
                                ${song.tempo}
                            </span>
                            <span class="bg-gradient-to-r from-purple-500 to-pink-600 text-white px-4 py-2 rounded-2xl text-sm font-bold shadow-md flex items-center">
                                <span class="ml-2">🎹</span>
                                ${song.transpose > 0 ? '+' : ''}${song.transpose}
                            </span>
                        </div>
                        
                        <div id="chords-${song.id}" class="bg-gray-50 p-4 rounded-2xl mb-3 border border-gray-200">
                            <div class="text-sm font-bold text-gray-700 mb-2 flex items-center justify-between cursor-pointer hover:bg-gray-100 transition-colors p-2 rounded-xl -m-2" onclick="toggleSongSection(${song.id}, 'chords')">
                                <span>🎸 אקורדים</span>
                                <span id="chords-arrow-${song.id}" class="text-gray-500 transition-transform duration-300">▼</span>
                            </div>
                            <div id="chords-content-${song.id}" class="hidden text-sm text-gray-600 font-mono bg-white p-3 rounded-xl border">${song.chords}</div>
                        </div>
                        
                        <div id="lyrics-${song.id}" class="bg-green-50 p-4 rounded-2xl border border-green-200">
                            <div class="text-sm font-bold text-green-700 mb-2 flex items-center justify-between cursor-pointer hover:bg-green-100 transition-colors p-2 rounded-xl -m-2" onclick="toggleSongSection(${song.id}, 'lyrics')">
                                <span>📝 מילים</span>
                                <span id="lyrics-arrow-${song.id}" class="text-green-500 transition-transform duration-300">▼</span>
                            </div>
                            <div id="lyrics-content-${song.id}" class="hidden text-sm text-green-600 whitespace-pre-line bg-white p-3 rounded-xl border border-green-200">${song.lyrics}</div>
                        </div>
                        
                        ${isLoggedIn ? `
                            <div class="flex justify-center mt-4">
                                <button onclick="editSong(${song.id})" class="bg-blue-600 text-white px-4 py-2 rounded-2xl text-sm hover:bg-blue-700 transition-colors font-medium flex items-center">
                                    <span class="ml-1">✏️</span>
                                    <span>ערוך</span>
                                </button>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        function renderEquipment() {
            const container = document.getElementById('equipmentContainer');
            const categories = [...new Set(equipment.map(item => item.category))];
            
            container.innerHTML = categories.map(category => {
                const categoryItems = equipment.filter(item => item.category === category);
                const checkedCount = categoryItems.filter(item => item.checked).length;
                const totalCount = categoryItems.length;
                const percentage = Math.round((checkedCount / totalCount) * 100);
                
                return `
                    <div class="mb-6">
                        <div class="flex items-center justify-between mb-3">
                            <h3 class="text-lg font-bold text-gray-800">${category}</h3>
                            <div class="flex items-center">
                                <span class="text-sm text-gray-600 ml-2">${checkedCount}/${totalCount}</span>
                                <div class="w-20 h-2 bg-gray-200 rounded-full overflow-hidden">
                                    <div class="h-full bg-green-500 transition-all duration-300" style="width: ${percentage}%"></div>
                                </div>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3">
                            ${categoryItems.map(item => `
                                <div class="flex items-center p-3 bg-white border border-gray-200 rounded-2xl hover:bg-gray-50 transition-colors">
                                    <input type="checkbox" id="equipment-${item.id}" ${item.checked ? 'checked' : ''} 
                                           onchange="toggleEquipment(${item.id})"
                                           class="w-5 h-5 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2 ml-3">
                                    <label for="equipment-${item.id}" class="text-gray-700 font-medium cursor-pointer flex-1">${item.item}</label>
                                    ${item.checked ? '<span class="text-green-500 text-lg">✅</span>' : '<span class="text-gray-300 text-lg">⭕</span>'}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderStudents() {
            const container = document.getElementById('studentsContainer');
            container.innerHTML = students.map(student => {
                const progressPercentage = Math.round((student.lessonsCompleted / student.totalLessons) * 100);
                const eventDate = new Date(student.eventDate);
                const nextLessonDate = new Date(student.nextLesson);
                const formattedEventDate = eventDate.toLocaleDateString('he-IL');
                const formattedNextLesson = nextLessonDate.toLocaleDateString('he-IL');
                
                return `
                    <div class="p-6 hover:bg-gray-50 transition-colors">
                        <div class="flex flex-col lg:flex-row lg:justify-between lg:items-start">
                            <div class="flex-1 mb-4 lg:mb-0">
                                <div class="flex items-center mb-3">
                                    <h3 class="text-xl font-bold text-gray-800 ml-3">${student.name}</h3>
                                    <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium">תלמיד פרטי</span>
                                </div>
                                
                                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mb-4">
                                    <div class="bg-blue-50 p-3 rounded-2xl border border-blue-200">
                                        <div class="flex items-center mb-2">
                                            <span class="text-blue-600 ml-2 text-lg">📅</span>
                                            <span class="text-sm font-medium text-blue-700">תאריך בר מצווה</span>
                                        </div>
                                        <div class="text-blue-800 font-bold">${formattedEventDate}</div>
                                    </div>
                                    
                                    <div class="bg-green-50 p-3 rounded-2xl border border-green-200">
                                        <div class="flex items-center mb-2">
                                            <span class="text-green-600 ml-2 text-lg">📚</span>
                                            <span class="text-sm font-medium text-green-700">התקדמות שיעורים</span>
                                        </div>
                                        <div class="flex items-center">
                                            <span class="text-green-800 font-bold ml-2">${student.lessonsCompleted}/${student.totalLessons}</span>
                                            <div class="flex-1 h-2 bg-green-200 rounded-full overflow-hidden">
                                                <div class="h-full bg-green-500 transition-all duration-300" style="width: ${progressPercentage}%"></div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="bg-orange-50 p-3 rounded-2xl border border-orange-200">
                                        <div class="flex items-center mb-2">
                                            <span class="text-orange-600 ml-2 text-lg">⏰</span>
                                            <span class="text-sm font-medium text-orange-700">שיעור הבא</span>
                                        </div>
                                        <div class="text-orange-800 font-bold">${formattedNextLesson}</div>
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-4">
                                    <div class="bg-purple-50 p-4 rounded-2xl border border-purple-200">
                                        <div class="flex items-center mb-2">
                                            <span class="text-purple-600 ml-2 text-lg">📜</span>
                                            <span class="text-sm font-medium text-purple-700">פרטי קריאה</span>
                                        </div>
                                        <div class="space-y-1 text-sm">
                                            <div><span class="font-medium">פרשה:</span> ${student.parsha}</div>
                                            <div><span class="font-medium">סוג קריאה:</span> ${student.readingType}</div>
                                            <div><span class="font-medium">פרק תורה:</span> ${student.torahPortion}</div>
                                            <div><span class="font-medium">הפטרה:</span> ${student.haftarah}</div>
                                        </div>
                                    </div>
                                    
                                    <div class="bg-gray-50 p-4 rounded-2xl border border-gray-200">
                                        <div class="flex items-center mb-2">
                                            <span class="text-gray-600 ml-2 text-lg">📝</span>
                                            <span class="text-sm font-medium text-gray-700">התקדמות והערות</span>
                                        </div>
                                        <div class="text-sm text-gray-600 mb-2">${student.progress}</div>
                                        <div class="text-xs text-gray-500">${student.specialNotes}</div>
                                    </div>
                                </div>
                                
                                <div class="bg-yellow-50 p-4 rounded-2xl border border-yellow-200">
                                    <div class="flex items-center mb-2">
                                        <span class="text-yellow-600 ml-2 text-lg">🎤</span>
                                        <span class="text-sm font-medium text-yellow-700">הקלטות</span>
                                        ${student.hasRecording ? '<span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs mr-2">יש הקלטה</span>' : '<span class="bg-red-100 text-red-800 px-2 py-1 rounded-full text-xs mr-2">אין הקלטה</span>'}
                                    </div>
                                    <div class="text-sm text-yellow-600">${student.recordingNotes}</div>
                                </div>
                            </div>
                            
                            <div class="flex flex-col space-y-2 lg:mr-6">
                                <button onclick="callStudent('${student.phone}')" class="bg-green-600 text-white px-4 py-2 rounded-2xl text-sm hover:bg-green-700 transition-colors font-medium flex items-center justify-center">
                                    <span class="ml-1">📞</span>
                                    <span>התקשר</span>
                                </button>
                                <button onclick="sendWhatsApp('${student.phone}', '${student.name}')" class="bg-blue-600 text-white px-4 py-2 rounded-2xl text-sm hover:bg-blue-700 transition-colors font-medium flex items-center justify-center">
                                    <span class="ml-1">📱</span>
                                    <span>WhatsApp</span>
                                </button>
                                <button onclick="editStudent(${student.id})" class="bg-orange-600 text-white px-4 py-2 rounded-2xl text-sm hover:bg-orange-700 transition-colors font-medium flex items-center justify-center">
                                    <span class="ml-1">✏️</span>
                                    <span>ערוך</span>
                                </button>
                                <button onclick="addRecording(${student.id})" class="bg-purple-600 text-white px-4 py-2 rounded-2xl text-sm hover:bg-purple-700 transition-colors font-medium flex items-center justify-center">
                                    <span class="ml-1">🎤</span>
                                    <span>הקלטה</span>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderPayments() {
            const container = document.getElementById('paymentsContainer');
            container.innerHTML = payments.map(payment => `
                <div class="bg-white border border-gray-200 rounded-2xl p-6 mb-4 hover:shadow-md transition-all">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-bold text-gray-800">${payment.eventName}</h3>
                        <div class="flex items-center space-x-2 space-x-reverse">
                            ${payment.receiptIssued ? 
                                '<span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium">הוצאה קבלה</span>' : 
                                '<span class="bg-red-100 text-red-800 px-3 py-1 rounded-full text-sm font-medium">לא הוצאה קבלה</span>'
                            }
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="bg-blue-50 p-4 rounded-xl border border-blue-200">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-blue-700 font-medium">קלידן</span>
                                ${payment.keyboardistPaid ? 
                                    '<span class="text-green-600 text-lg">✅</span>' : 
                                    '<span class="text-red-600 text-lg">❌</span>'
                                }
                            </div>
                            <div class="text-blue-800 font-bold">₪${payment.keyboardistAmount}</div>
                            <button onclick="togglePayment('keyboardist', ${payment.id})" class="mt-2 w-full ${payment.keyboardistPaid ? 'bg-red-600 hover:bg-red-700' : 'bg-green-600 hover:bg-green-700'} text-white px-3 py-1 rounded-lg text-sm transition-colors">
                                ${payment.keyboardistPaid ? 'בטל תשלום' : 'סמן כשולם'}
                            </button>
                        </div>
                        
                        <div class="bg-purple-50 p-4 rounded-xl border border-purple-200">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-purple-700 font-medium">מתופפים</span>
                                ${payment.drummersPaid ? 
                                    '<span class="text-green-600 text-lg">✅</span>' : 
                                    '<span class="text-red-600 text-lg">❌</span>'
                                }
                            </div>
                            <div class="text-purple-800 font-bold">₪${payment.drummersAmount}</div>
                            <button onclick="togglePayment('drummers', ${payment.id})" class="mt-2 w-full ${payment.drummersPaid ? 'bg-red-600 hover:bg-red-700' : 'bg-green-600 hover:bg-green-700'} text-white px-3 py-1 rounded-lg text-sm transition-colors">
                                ${payment.drummersPaid ? 'בטל תשלום' : 'סמן כשולם'}
                            </button>
                        </div>
                        
                        <div class="bg-orange-50 p-4 rounded-xl border border-orange-200">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-orange-700 font-medium">מנהל</span>
                                ${payment.managerPaid ? 
                                    '<span class="text-green-600 text-lg">✅</span>' : 
                                    '<span class="text-red-600 text-lg">❌</span>'
                                }
                            </div>
                            <div class="text-orange-800 font-bold">₪${payment.managerAmount}</div>
                            <button onclick="togglePayment('manager', ${payment.id})" class="mt-2 w-full ${payment.managerPaid ? 'bg-red-600 hover:bg-red-700' : 'bg-green-600 hover:bg-green-700'} text-white px-3 py-1 rounded-lg text-sm transition-colors">
                                ${payment.managerPaid ? 'בטל תשלום' : 'סמן כשולם'}
                            </button>
                        </div>
                    </div>
                    
                    <div class="mt-4 pt-4 border-t border-gray-200">
                        <button onclick="toggleReceipt(${payment.id})" class="w-full ${payment.receiptIssued ? 'bg-red-600 hover:bg-red-700' : 'bg-blue-600 hover:bg-blue-700'} text-white px-4 py-2 rounded-xl transition-colors font-medium">
                            ${payment.receiptIssued ? '🧾 בטל קבלה' : '🧾 הוצא קבלה'}
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function renderSongsLibrary() {
            const container = document.getElementById('songsLibraryContainer');
            const searchTerm = document.getElementById('songSearch').value.toLowerCase();
            
            const filteredSongs = songsLibrary.filter(song => 
                song.name.toLowerCase().includes(searchTerm) ||
                song.category.toLowerCase().includes(searchTerm) ||
                song.lyrics.toLowerCase().includes(searchTerm)
            );
            
            container.innerHTML = filteredSongs.map((song, index) => {
                const gradientClass = `card-gradient-${(index % 6) + 1}`;
                return `
                    <div class="bg-white border border-gray-200 rounded-3xl shadow-lg hover:shadow-xl transition-all duration-300 overflow-hidden mb-4">
                        <div class="${gradientClass} p-4 text-white cursor-pointer" onclick="toggleMealSongDetails(${song.id})">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <span class="text-2xl ml-3">🎼</span>
                                    <h3 class="text-lg font-bold">${song.name}</h3>
                                </div>
                                <div class="flex items-center space-x-2 space-x-reverse">
                                    <span class="bg-white bg-opacity-20 text-white px-3 py-1 rounded-full text-xs font-medium">${song.category}</span>
                                    <span id="arrow-${song.id}" class="text-white text-xl transition-transform duration-300">▼</span>
                                </div>
                            </div>
                        </div>

                        <div id="song-details-${song.id}" class="hidden p-4">
                            <div class="flex flex-wrap gap-2 mb-4">
                                <span class="bg-gradient-to-r from-blue-500 to-indigo-600 text-white px-4 py-2 rounded-2xl text-sm font-bold shadow-md flex items-center">
                                    <span class="ml-2">🎵</span>
                                    ${song.key}
                                </span>
                                <span class="bg-gradient-to-r from-green-500 to-emerald-600 text-white px-4 py-2 rounded-2xl text-sm font-bold shadow-md flex items-center">
                                    <span class="ml-2">⏱️</span>
                                    ${song.tempo}
                                </span>
                                <span class="bg-gradient-to-r from-purple-500 to-pink-600 text-white px-4 py-2 rounded-2xl text-sm font-bold shadow-md flex items-center">
                                    <span class="ml-2">🎹</span>
                                    ${song.transpose > 0 ? '+' : ''}${song.transpose}
                                </span>
                            </div>
                            
                            <div id="chords-${song.id}" class="bg-gray-50 p-4 rounded-2xl mb-3 border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors" onclick="toggleSongSection(${song.id}, 'chords')">
                                <div class="text-sm font-bold text-gray-700 mb-2 flex items-center justify-between">
                                    <span>🎸 אקורדים</span>
                                    <span id="chords-arrow-${song.id}" class="text-gray-500 transition-transform duration-300">▼</span>
                                </div>
                                <div id="chords-content-${song.id}" class="hidden text-sm text-gray-600 font-mono bg-white p-3 rounded-xl border">${song.chords}</div>
                            </div>
                            
                            <div id="lyrics-${song.id}" class="bg-indigo-50 p-4 rounded-2xl border border-indigo-200 cursor-pointer hover:bg-indigo-100 transition-colors" onclick="toggleSongSection(${song.id}, 'lyrics')">
                                <div class="text-sm font-bold text-indigo-700 mb-2 flex items-center justify-between">
                                    <span>📝 מילים</span>
                                    <span id="lyrics-arrow-${song.id}" class="text-indigo-500 transition-transform duration-300">▼</span>
                                </div>
                                <div id="lyrics-content-${song.id}" class="hidden text-sm text-indigo-600 whitespace-pre-line bg-white p-3 rounded-xl border border-indigo-200">${song.lyrics}</div>
                            </div>
                            
                            <div class="flex flex-wrap gap-2 mt-4 justify-center">
                                ${song.youtubeLink ? `
                                    <button onclick="openYoutube('${song.youtubeLink}')" class="bg-red-600 text-white px-4 py-2 rounded-2xl text-sm hover:bg-red-700 transition-colors font-medium flex items-center">
                                        <span class="ml-1">📺</span>
                                        <span>YouTube</span>
                                    </button>
                                ` : ''}
                                <button onclick="editSong(${song.id})" class="bg-blue-600 text-white px-4 py-2 rounded-2xl text-sm hover:bg-blue-700 transition-colors font-medium flex items-center">
                                    <span class="ml-1">✏️</span>
                                    <span>ערוך</span>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderImportantLinks() {
            const container = document.getElementById('importantLinksContainer');
            const categories = [...new Set(importantLinks.map(link => link.category))];
            
            container.innerHTML = categories.map(category => {
                const categoryLinks = importantLinks.filter(link => link.category === category);
                
                return `
                    <div class="mb-6">
                        <h3 class="text-lg font-bold text-gray-800 mb-3">${category}</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            ${categoryLinks.map(link => `
                                <div class="bg-white border border-gray-200 rounded-2xl p-4 hover:shadow-md transition-all cursor-pointer" onclick="openLink('${link.url}')">
                                    <div class="flex items-start">
                                        <span class="text-2xl ml-3 flex-shrink-0">${link.icon}</span>
                                        <div class="flex-1">
                                            <h4 class="font-bold text-gray-800 mb-1">${link.name}</h4>
                                            <p class="text-sm text-gray-600 mb-2">${link.description}</p>
                                            <div class="text-xs text-blue-600 hover:text-blue-800 transition-colors">
                                                לחץ לפתיחה ←
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Interactive functions
        function toggleEquipment(id) {
            const item = equipment.find(e => e.id === id);
            if (item) {
                item.checked = !item.checked;
                renderEquipment();
            }
        }

        function togglePayment(type, id) {
            const payment = payments.find(p => p.id === id);
            if (payment) {
                switch(type) {
                    case 'keyboardist':
                        payment.keyboardistPaid = !payment.keyboardistPaid;
                        break;
                    case 'drummers':
                        payment.drummersPaid = !payment.drummersPaid;
                        break;
                    case 'manager':
                        payment.managerPaid = !payment.managerPaid;
                        break;
                }
                renderPayments();
            }
        }

        function toggleReceipt(id) {
            const payment = payments.find(p => p.id === id);
            if (payment) {
                payment.receiptIssued = !payment.receiptIssued;
                renderPayments();
            }
        }

        function toggleSongDetails(id) {
            const detailsElement = document.getElementById(`song-details-${id}`);
            const arrowElement = document.getElementById(`arrow-${id}`);
            
            if (!detailsElement || !arrowElement) return;
            
            if (detailsElement.classList.contains('hidden')) {
                detailsElement.classList.remove('hidden');
                arrowElement.style.transform = 'rotate(180deg)';
            } else {
                detailsElement.classList.add('hidden');
                arrowElement.style.transform = 'rotate(0deg)';
            }
        }

        function toggleMealSongDetails(id) {
            const detailsElement = document.getElementById(`song-details-${id}`);
            const arrowElement = document.getElementById(`arrow-${id}`);
            
            if (!detailsElement || !arrowElement) return;
            
            if (detailsElement.classList.contains('hidden')) {
                detailsElement.classList.remove('hidden');
                arrowElement.style.transform = 'rotate(180deg)';
            } else {
                detailsElement.classList.add('hidden');
                arrowElement.style.transform = 'rotate(0deg)';
            }
        }

        function toggleSongSection(id, section) {
            const contentElement = document.getElementById(`${section}-content-${id}`);
            const arrowElement = document.getElementById(`${section}-arrow-${id}`);
            
            if (!contentElement || !arrowElement) return;
            
            if (contentElement.classList.contains('hidden')) {
                contentElement.classList.remove('hidden');
                arrowElement.style.transform = 'rotate(180deg)';
            } else {
                contentElement.classList.add('hidden');
                arrowElement.style.transform = 'rotate(0deg)';
            }
        }

        function toggleSongView(id, viewType) {
            const chordsElement = document.getElementById(`chords-${id}`);
            const lyricsElement = document.getElementById(`lyrics-${id}`);
            
            if (!chordsElement || !lyricsElement) return;
            
            switch(viewType) {
                case 'chords':
                    chordsElement.style.display = 'block';
                    lyricsElement.style.display = 'none';
                    break;
                case 'lyrics':
                    chordsElement.style.display = 'none';
                    lyricsElement.style.display = 'block';
                    break;
                case 'both':
                    chordsElement.style.display = 'block';
                    lyricsElement.style.display = 'block';
                    break;
            }
        }

        function editSong(id) {
            alert(`עריכת שיר מספר ${id} - יפתח חלון עריכה`);
        }

        function callStudent(phone) {
            window.open(`tel:${phone}`, '_self');
        }

        function sendWhatsApp(phone, name) {
            const message = encodeURIComponent(`שלום ${name}, איך ההכנות לבר המצווה?`);
            window.open(`https://wa.me/${phone.replace(/[^0-9]/g, '')}?text=${message}`, '_blank');
        }

        function sendWhatsAppToParent(phone, parentName, childName) {
            const message = encodeURIComponent(`שלום ${parentName}, בקשר לבר המצווה של ${childName}`);
            window.open(`https://wa.me/${phone.replace(/[^0-9]/g, '')}?text=${message}`, '_blank');
        }

        function editStudent(id) {
            alert(`עריכת תלמיד מספר ${id} - יפתח חלון עריכה`);
        }

        function addRecording(id) {
            alert(`הוספת הקלטה לתלמיד מספר ${id} - יפתח ממשק הקלטה`);
        }

        function editEvent(id) {
            alert(`עריכת אירוע מספר ${id} - יפתח חלון עריכה`);
        }

        function deleteEvent(id) {
            if (confirm('האם אתה בטוח שברצונך למחוק את האירוע?')) {
                alert(`מחיקת אירוע מספר ${id}`);
            }
        }

        function addNewEvent() {
            alert('הוספת אירוע חדש - יפתח טופס הוספה');
        }

        function addNewSong() {
            alert('הוספת שיר חדש - יפתח טופס הוספה');
        }

        function addNewLink() {
            alert('הוספת קישור חדש - יפתח טופס הוספה');
        }

        function openEventModal(id) {
            const event = events.find(e => e.id === id);
            if (event) {
                modalTitle.textContent = `בר מצווה - ${event.name}`;
                modalContent.innerHTML = `
                    <div class="space-y-4">
                        <div class="space-y-3">
                            <div class="card-professional bg-gradient-to-br from-blue-500 to-indigo-600 text-white p-3 rounded-xl shadow-sm">
                                <div class="flex items-center">
                                    <span class="text-lg ml-2">📅</span>
                                    <div>
                                        <div class="text-xs opacity-80">תאריך</div>
                                        <span class="font-bold text-sm">${new Date(event.date).toLocaleDateString('he-IL')}</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card-professional bg-gradient-to-br from-purple-500 to-pink-500 text-white p-3 rounded-xl shadow-sm cursor-pointer hover:shadow-md transition-all" onclick="event.stopPropagation(); openWaze('${event.wazeLink}')">
                                <div class="flex items-center">
                                    <span class="text-lg ml-2">📍</span>
                                    <div>
                                        <div class="text-xs opacity-80">מיקום</div>
                                        <span class="font-bold text-sm">${event.location}</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card-professional bg-gradient-to-br from-green-500 to-emerald-600 text-white p-3 rounded-xl shadow-sm">
                                <div class="flex items-center">
                                    <span class="text-lg ml-2">⏰</span>
                                    <div>
                                        <div class="text-xs opacity-80">זמנים</div>
                                        <span class="font-bold text-sm">אורחים: ${event.guestArrivalTime || event.time} • תחילת אירוע: ${event.eventStartTime || event.time}</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card-professional bg-gradient-to-br from-orange-500 to-red-500 text-white p-3 rounded-xl shadow-sm">
                                <div class="flex items-center">
                                    <span class="text-lg ml-2">📦</span>
                                    <div>
                                        <div class="text-xs opacity-80">סוג חבילה</div>
                                        <span class="font-bold text-sm">${event.package}</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card-professional bg-gradient-to-br from-pink-500 to-rose-500 text-white p-3 rounded-xl shadow-sm">
                                <div class="flex items-center">
                                    <span class="text-lg ml-2">🎵</span>
                                    <div>
                                        <div class="text-xs opacity-80">נגנים</div>
                                        <span class="font-bold text-sm">קלידן: ${event.keyboardist ? 'כן' : 'לא'} • מתופפים: ${event.drummers > 0 ? `${event.drummers}` : 'לא'}</span>
                                    </div>
                                </div>
                            </div>
                            
                            ${isLoggedIn ? `
                                <div class="card-professional bg-gradient-to-br from-emerald-500 to-teal-600 text-white p-3 rounded-xl shadow-sm">
                                    <div class="flex items-center">
                                        <span class="text-lg ml-2">👥</span>
                                        <div>
                                            <div class="text-xs opacity-80">איש קשר</div>
                                            <span class="font-bold text-sm">${event.parentName} • ${event.parentPhone}</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="card-professional bg-gradient-to-br from-yellow-500 to-orange-500 text-white p-3 rounded-xl shadow-sm">
                                    <div class="flex items-center">
                                        <span class="text-lg ml-2">💰</span>
                                        <div>
                                            <div class="text-xs opacity-80">מחיר</div>
                                            <span class="font-bold text-sm">₪${event.price}</span>
                                        </div>
                                    </div>
                                </div>
                            ` : ''}
                            
                            <div class="card-professional bg-gradient-to-br from-teal-500 to-cyan-500 text-white p-3 rounded-xl shadow-sm">
                                <div class="flex items-start">
                                    <span class="text-lg ml-2 mt-0.5">📝</span>
                                    <div>
                                        <div class="text-xs opacity-80">הערות</div>
                                        <span class="font-bold text-sm leading-relaxed">${event.notes}</span>
                                    </div>
                                </div>
                            </div>
                            
                            ${event.mediaLinks && (event.mediaLinks.photos || event.mediaLinks.videos) ? `
                                <div class="flex gap-2">
                                    ${event.mediaLinks.photos ? `
                                        <a href="${event.mediaLinks.photos}" target="_blank" class="card-professional bg-gradient-to-br from-indigo-500 to-purple-600 text-white p-3 rounded-xl shadow-sm hover:shadow-md transition-all flex items-center flex-1">
                                            <span class="text-lg ml-2">📷</span>
                                            <span class="font-bold text-sm">תמונות</span>
                                        </a>
                                    ` : ''}
                                    ${event.mediaLinks.videos ? `
                                        <a href="${event.mediaLinks.videos}" target="_blank" class="card-professional bg-gradient-to-br from-violet-500 to-purple-600 text-white p-3 rounded-xl shadow-sm hover:shadow-md transition-all flex items-center flex-1">
                                            <span class="text-lg ml-2">🎥</span>
                                            <span class="font-bold text-sm">סרטונים</span>
                                        </a>
                                    ` : ''}
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
                eventModal.classList.remove('hidden');
            }
        }

        function openWaze(link) {
            window.open(link, '_blank');
        }

        function openYeshInvoice() {
            window.open('https://www.ishhashounit.co.il', '_blank');
        }

        function openYoutube(link) {
            window.open(link, '_blank');
        }

        function openLink(url) {
            window.open(url, '_blank');
        }

        function toggleEventCollapse(id) {
            if (eventStates[id] === 'expanded') {
                eventStates[id] = 'collapsed';
            } else {
                eventStates[id] = 'expanded';
            }
            renderEvents();
        }

        function managePrayerCategories() {
            alert('ניהול קטגוריות שירי תפילה - יפתח חלון ניהול');
        }

        function manageMealCategories() {
            alert('ניהול קטגוריות שירי סעודה - יפתח חלון ניהול');
        }

        function addToGoogleCalendar(id) {
            const event = events.find(e => e.id === id);
            if (event) {
                const startDate = new Date(event.date + 'T' + event.time);
                const endDate = new Date(startDate.getTime() + 3 * 60 * 60 * 1000); // 3 hours later
                
                const details = `בר מצווה של ${event.name}
מיקום: ${event.location}
חבילה: ${event.package}
קלידן: ${event.keyboardist ? 'כן' : 'לא'}
מתופפים: ${event.drummers > 0 ? event.drummers : 'לא'}
הערות: ${event.notes}
${isLoggedIn ? `איש קשר: ${event.parentName} - ${event.parentPhone}` : ''}`;
                
                const googleCalendarUrl = `https://calendar.google.com/calendar/render?action=TEMPLATE&text=בר מצווה - ${event.name}&dates=${startDate.toISOString().replace(/[-:]/g, '').split('.')[0]}Z/${endDate.toISOString().replace(/[-:]/g, '').split('.')[0]}Z&details=${encodeURIComponent(details)}&location=${encodeURIComponent(event.location)}`;
                
                window.open(googleCalendarUrl, '_blank');
            }
        }

        function refreshDataFromCMS() {
            alert('מרענן נתונים מהמערכת...');
        }

        function exportToCMSFormat() {
            alert('מייצא נתונים לפורמט CMS...');
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', async () => {
            await initAuth0();
            renderCurrentPage();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'964547bda5168e48',t:'MTc1MzM3OTY0MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
