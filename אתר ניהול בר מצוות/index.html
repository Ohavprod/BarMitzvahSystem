<!DOCTYPE html> 
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8"> 
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>××¢×¨×›×ª × ×™×”×•×œ ××™×¨×•×¢×™ ×‘×¨ ××¦×•×•×”</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Netlify Identity -->
    <script type="text/javascript" src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    <!-- Auth0 -->
    <script src="https://cdn.auth0.com/js/auth0-spa-js/2.0/auth0-spa-js.production.js"></script>
    <!-- Decap CMS -->
    <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>
    
    <!-- PWA Manifest -->
    <link rel="manifest" id="manifest">
    <meta name="theme-color" content="#1e3a8a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="×‘×¨ ××¦×•×•×” ×× ×”×œ">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%231e3a8a'/><text y='50' x='50' text-anchor='middle' dominant-baseline='middle' font-size='40' fill='white'>ğŸµ</text></svg>">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#1e3a8a',
                        secondary: '#374151',
                        accent: '#059669'
                    },
                    fontFamily: {
                        'rounded': ['ui-rounded', 'system-ui', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Varela+Round&family=Nunito:wght@300;400;500;600;700;800&display=swap');
        body { 
            font-family: 'Nunito', 'Varela Round', sans-serif; 
            font-weight: 500;
        }
        .gradient-header { background: linear-gradient(135deg, #1e3a8a 0%, #3730a3 100%); }
        .card-professional { 
            transition: all 0.3s ease; 
            border-left: 4px solid transparent;
        }
        .card-professional:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
            border-left-color: #1e3a8a;
        }
        .card-gradient-1 { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card-gradient-2 { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .card-gradient-3 { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .card-gradient-4 { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
        .card-gradient-5 { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
        .card-gradient-6 { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); }
        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
        }
        .sidebar {
            transform: translateX(100%);
            transition: transform 0.3s ease-in-out;
        }
        .sidebar.open {
            transform: translateX(0);
        }
        .song-card {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-left: 4px solid #3b82f6;
        }
        .song-card:nth-child(even) {
            background: linear-gradient(135deg, #fef7ff 0%, #f3e8ff 100%);
            border-left-color: #8b5cf6;
        }
        .song-card:nth-child(3n) {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border-left-color: #10b981;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Sidebar -->
    <div id="sidebar" class="sidebar fixed top-0 right-0 h-full w-80 bg-white shadow-2xl z-50 overflow-y-auto">
        <div class="p-6 border-b border-gray-200 bg-gradient-to-l from-blue-600 to-purple-600 text-white">
            <div class="flex justify-between items-center">
                <h2 class="text-xl font-bold">×ª×¤×¨×™×˜ × ×™×”×•×œ</h2>
                <button id="closeSidebar" class="text-white hover:text-gray-200 text-2xl font-bold p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-all">
                    Ã—
                </button>
            </div>
        </div>
        
        <!-- Login Section -->
        <div class="p-4 border-b border-gray-200">
            <div id="loginSection">
                <button id="loginBtn" class="w-full bg-blue-600 text-white px-3 py-2 rounded-2xl text-sm font-medium hover:bg-blue-700 transition-colors shadow-md flex items-center justify-center">
                    <span class="ml-2">ğŸ”</span>
                    <span>×›× ×™×¡×” ×œ×× ×”×œ</span>
                </button>
            </div>
            <div id="userInfo" class="hidden">
                <div class="bg-green-50 p-4 rounded-2xl border border-green-200">
                    <div class="flex items-center justify-between mb-3">
                        <div>
                            <div class="text-green-800 font-medium">×× ×”×œ ×”××¢×¨×›×ª</div>
                            <div class="text-green-600 text-sm">×’×™×©×” ××œ××”</div>
                        </div>
                        <span class="text-green-500 text-2xl">âœ…</span>
                    </div>
                    <div class="space-y-2">
                        <button id="editContentBtn" class="w-full bg-purple-600 text-white px-4 py-2 rounded-2xl text-sm hover:bg-purple-700 transition-colors">
                            âœï¸ ×¢×¨×™×›×ª ×ª×•×›×Ÿ
                        </button>
                        <button onclick="refreshDataFromCMS()" class="w-full bg-blue-600 text-white px-4 py-2 rounded-2xl text-sm hover:bg-blue-700 transition-colors">
                            ğŸ”„ ×¨×¢× ×Ÿ × ×ª×•× ×™×
                        </button>
                        <button onclick="exportToCMSFormat()" class="w-full bg-green-600 text-white px-4 py-2 rounded-2xl text-sm hover:bg-green-700 transition-colors">
                            ğŸ“¥ ×™×™×¦× × ×ª×•× ×™×
                        </button>
                        <div class="mt-3 p-2 bg-yellow-50 rounded-2xl border border-yellow-200">
                            <div class="text-xs text-yellow-700 font-medium">ğŸ’¾ ×©××™×¨×” ××•×˜×•××˜×™×ª</div>
                            <div class="text-xs text-yellow-600">×›×œ ×”×©×™× ×•×™×™× × ×©××¨×™× ××•×˜×•××˜×™×ª ×œ-CMS</div>
                        </div>
                        <button id="logoutBtn" class="w-full bg-red-600 text-white px-4 py-2 rounded-2xl text-sm hover:bg-red-700 transition-colors">
                            ×™×¦×™××”
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <nav class="p-4">
            <ul class="space-y-2">
                <li>
                    <button onclick="showPage('events')" class="nav-item w-full text-right p-4 rounded-2xl hover:bg-blue-50 transition-all flex items-center">
                        <span class="text-blue-500 ml-3 text-xl">ğŸ“…</span>
                        <span class="font-medium">××™×¨×•×¢×™×</span>
                    </button>
                </li>
                <li>
                    <button onclick="showPage('prayer-songs')" class="nav-item w-full text-right p-4 rounded-2xl hover:bg-purple-50 transition-all flex items-center">
                        <span class="text-purple-500 ml-3 text-xl">ğŸµ</span>
                        <span class="font-medium">×©×™×¨×™ ×ª×¤×™×œ×”</span>
                    </button>
                </li>
                <li>
                    <button onclick="showPage('meal-songs')" class="nav-item w-full text-right p-4 rounded-2xl hover:bg-green-50 transition-all flex items-center">
                        <span class="text-green-500 ml-3 text-xl">ğŸ½ï¸</span>
                        <span class="font-medium">×©×™×¨×™ ×¡×¢×•×“×”</span>
                    </button>
                </li>
                <li id="adminSection" class="border-t border-gray-200 pt-4 mt-4 hidden">
                    <div class="text-gray-500 text-sm font-medium mb-2 px-4">××–×•×¨ ××™×©×™</div>
                    <button onclick="showPage('admin')" class="nav-item w-full text-right p-4 rounded-2xl hover:bg-orange-50 transition-all flex items-center">
                        <span class="text-orange-500 ml-3 text-xl">ğŸ‘¤</span>
                        <span class="font-medium">× ×™×”×•×œ ×ª×œ××™×“×™×</span>
                    </button>
                </li>
                <li id="equipmentSection" class="hidden">
                    <button onclick="showPage('equipment')" class="nav-item w-full text-right p-4 rounded-2xl hover:bg-red-50 transition-all flex items-center">
                        <span class="text-red-500 ml-3 text-xl">ğŸ¤</span>
                        <span class="font-medium">×¦'×§×œ×™×¡×˜ ×¦×™×•×“</span>
                    </button>
                </li>
                <li id="paymentsSection" class="hidden">
                    <button onclick="showPage('payments')" class="nav-item w-full text-right p-4 rounded-2xl hover:bg-emerald-50 transition-all flex items-center">
                        <span class="text-emerald-500 ml-3 text-xl">ğŸ’°</span>
                        <span class="font-medium">××¢×§×‘ ×ª×©×œ×•××™×</span>
                    </button>
                </li>
                <li id="songsLibrarySection" class="hidden">
                    <button onclick="showPage('songs-library')" class="nav-item w-full text-right p-4 rounded-2xl hover:bg-indigo-50 transition-all flex items-center">
                        <span class="text-indigo-500 ml-3 text-xl">ğŸ¼</span>
                        <span class="font-medium">×¡×¤×¨×™×™×ª ×©×™×¨×™×</span>
                    </button>
                </li>
                <li id="importantLinksSection" class="hidden">
                    <button onclick="showPage('important-links')" class="nav-item w-full text-right p-4 rounded-2xl hover:bg-cyan-50 transition-all flex items-center">
                        <span class="text-cyan-500 ml-3 text-xl">ğŸ”—</span>
                        <span class="font-medium">×§×™×©×•×¨×™× ×—×©×•×‘×™×</span>
                    </button>
                </li>
            </ul>
        </nav>
    </div>

    <!-- Overlay -->
    <div id="overlay" class="hidden fixed inset-0 bg-black bg-opacity-50 z-40" onclick="closeSidebar()"></div>

    <!-- Header -->
    <header class="gradient-header text-white shadow-lg">
        <div class="container mx-auto px-4 sm:px-6 py-4 sm:py-6">
            <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center">
                <div class="mb-4 sm:mb-0">
                    <h1 class="text-2xl sm:text-3xl font-bold mb-1">××¢×¨×›×ª × ×™×”×•×œ ××™×¨×•×¢×™ ×‘×¨ ××¦×•×•×”</h1>
                    <p class="text-blue-100 text-sm sm:text-lg">× ×™×”×•×œ ×ª×¤×™×œ×” â€¢ ×œ×™××•×“ â€¢ ×©×™×¨×™× ×•×¤×™×•×˜×™×</p>
                </div>
                <div class="flex items-center space-x-3 space-x-reverse">
                    <button id="installApp" class="bg-green-600 text-white px-4 py-2 rounded-2xl hover:bg-green-700 transition-all flex items-center hidden">
                        <span class="ml-2">ğŸ“±</span>
                        <span>×”×ª×§×Ÿ ××¤×œ×™×§×¦×™×”</span>
                    </button>
                    <button id="menuBtn" class="bg-white bg-opacity-20 text-white px-4 py-2 rounded-2xl hover:bg-opacity-30 transition-all flex items-center">
                        <span class="ml-2">â˜°</span>
                        <span>×ª×¤×¨×™×˜</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 sm:px-6 py-6 sm:py-8">
        <!-- Events Page -->
        <div id="events-page" class="page">
            <div class="bg-white rounded-3xl shadow-lg border border-gray-100">
                <div class="bg-gradient-to-l from-blue-50 to-indigo-50 border-b border-gray-200 p-4 sm:p-6 rounded-t-3xl">
                    <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center">
                        <div class="mb-4 sm:mb-0">
                            <h2 class="text-xl sm:text-2xl font-bold text-gray-800 mb-1">××™×¨×•×¢×™× ×§×¨×•×‘×™×</h2>
                            <p class="text-gray-600 text-sm sm:text-base">×–×× ×™ ×”×’×¢×ª ×”××•×¨×—×™× ×•×–×× ×™ ×ª×—×™×œ×ª ×”××™×¨×•×¢</p>
                        </div>
                        <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-3 sm:space-x-reverse">
                            <select id="packageFilter" class="border border-gray-300 rounded-2xl px-3 sm:px-4 py-2 text-gray-700 bg-white shadow-sm text-sm sm:text-base">
                                <option value="">×›×œ ×”×—×‘×™×œ×•×ª</option>
                                <option value="×—×‘×™×œ×” ×‘×¡×™×¡×™×ª">×—×‘×™×œ×” ×‘×¡×™×¡×™×ª</option>
                                <option value="×—×‘×™×œ×” ×—×’×™×’×™×ª">×—×‘×™×œ×” ×—×’×™×’×™×ª</option>
                                <option value="×—×‘×™×œ×ª ×”×›×œ ×›×œ×•×œ">×—×‘×™×œ×ª ×”×›×œ ×›×œ×•×œ</option>
                            </select>
                            <select id="keyboardistFilter" class="border border-gray-300 rounded-2xl px-3 sm:px-4 py-2 text-gray-700 bg-white shadow-sm text-sm sm:text-base">
                                <option value="">×›×œ ×”××™×¨×•×¢×™×</option>
                                <option value="true">×¢× ×§×œ×™×“×Ÿ</option>
                                <option value="false">×œ×œ× ×§×œ×™×“×Ÿ</option>
                            </select>
                            <select id="drummersFilter" class="border border-gray-300 rounded-2xl px-3 sm:px-4 py-2 text-gray-700 bg-white shadow-sm text-sm sm:text-base">
                                <option value="">×›×œ ×”××™×¨×•×¢×™×</option>
                                <option value="true">×¢× ××ª×•×¤×¤×™×</option>
                                <option value="false">×œ×œ× ××ª×•×¤×¤×™×</option>
                            </select>
                            <button id="addEventBtn" class="bg-blue-600 text-white px-4 sm:px-6 py-2 rounded-2xl hover:bg-blue-700 transition-colors font-medium shadow-md text-sm sm:text-base hidden" onclick="addNewEvent()">
                                â• ×”×•×¡×£ ××™×¨×•×¢
                            </button>
                        </div>
                    </div>
                </div>

                <div class="p-4 sm:p-6 space-y-4 sm:space-y-6" id="eventsContainer">
                    <!-- Event items will be populated here -->
                </div>
            </div>
        </div>

        <!-- Prayer Songs Page -->
        <div id="prayer-songs-page" class="page hidden">
            <div class="bg-white rounded-3xl shadow-lg border border-gray-100">
                <div class="bg-gradient-to-l from-purple-50 to-pink-50 border-b border-gray-200 p-4 sm:p-6 rounded-t-3xl">
                    <h2 class="text-xl sm:text-2xl font-bold text-gray-800 mb-1">×©×™×¨×™ ×ª×¤×™×œ×”</h2>
                    <p class="text-gray-600 text-sm sm:text-base">×¨×©×™××ª ×”×©×™×¨×™× ×œ×—×œ×§ ×”×ª×¤×™×œ×” ×‘×‘×¨ ×”××¦×•×•×”</p>
                </div>
                <div class="p-4 sm:p-6 space-y-4" id="prayerSongsContainer">
                    <!-- Prayer songs will be populated here -->
                </div>
            </div>
        </div>

        <!-- Meal Songs Page -->
        <div id="meal-songs-page" class="page hidden">
            <div class="bg-white rounded-3xl shadow-lg border border-gray-100">
                <div class="bg-gradient-to-l from-green-50 to-emerald-50 border-b border-gray-200 p-4 sm:p-6 rounded-t-3xl">
                    <h2 class="text-xl sm:text-2xl font-bold text-gray-800 mb-1">×©×™×¨×™ ×¡×¢×•×“×”</h2>
                    <p class="text-gray-600 text-sm sm:text-base">×¨×©×™××ª ×”×©×™×¨×™× ×œ×—×œ×§ ×”×¡×¢×•×“×” ×‘×‘×¨ ×”××¦×•×•×”</p>
                </div>
                <div class="p-4 sm:p-6 space-y-4" id="mealSongsContainer">
                    <!-- Meal songs will be populated here -->
                </div>
            </div>
        </div>

        <!-- Admin Page -->
        <div id="admin-page" class="page hidden">
            <div class="bg-white rounded-3xl shadow-lg border border-gray-100">
                <div class="bg-gradient-to-l from-orange-50 to-red-50 border-b border-gray-200 p-4 sm:p-6 rounded-t-3xl">
                    <h2 class="text-xl sm:text-2xl font-bold text-gray-800 mb-1">× ×™×”×•×œ ×ª×œ××™×“×™×</h2>
                    <p class="text-gray-600 text-sm sm:text-base">××¢×§×‘ ××—×¨ ×”×ª×§×“××•×ª ×”×ª×œ××™×“×™×</p>
                </div>
                <div class="divide-y divide-gray-200" id="studentsContainer">
                    <!-- Student items will be populated here -->
                </div>
            </div>
        </div>

        <!-- Equipment Page -->
        <div id="equipment-page" class="page hidden">
            <div class="bg-white rounded-3xl shadow-lg border border-gray-100">
                <div class="bg-gradient-to-l from-red-50 to-pink-50 border-b border-gray-200 p-4 sm:p-6 rounded-t-3xl">
                    <h2 class="text-xl sm:text-2xl font-bold text-gray-800 mb-1">×¦'×§×œ×™×¡×˜ ×¦×™×•×“</h2>
                    <p class="text-gray-600 text-sm sm:text-base">×¨×©×™××ª ×¦×™×•×“ × ×“×¨×© ×œ××™×¨×•×¢</p>
                </div>
                <div class="p-4 sm:p-6" id="equipmentContainer">
                    <!-- Equipment checklist will be populated here -->
                </div>
            </div>
        </div>

        <!-- Payments Page -->
        <div id="payments-page" class="page hidden">
            <div class="bg-white rounded-3xl shadow-lg border border-gray-100">
                <div class="bg-gradient-to-l from-emerald-50 to-teal-50 border-b border-gray-200 p-4 sm:p-6 rounded-t-3xl">
                    <h2 class="text-xl sm:text-2xl font-bold text-gray-800 mb-1">××¢×§×‘ ×ª×©×œ×•××™×</h2>
                    <p class="text-gray-600 text-sm sm:text-base">××¢×§×‘ ××—×¨ ×ª×©×œ×•××™× ×œ×§×œ×™×“×Ÿ, ××ª×•×¤×¤×™× ×•×§×‘×œ×•×ª</p>
                </div>
                <div class="p-4 sm:p-6" id="paymentsContainer">
                    <!-- Payments tracking will be populated here -->
                </div>
            </div>
        </div>

        <!-- Songs Library Page -->
        <div id="songs-library-page" class="page hidden">
            <div class="bg-white rounded-3xl shadow-lg border border-gray-100">
                <div class="bg-gradient-to-l from-indigo-50 to-purple-50 border-b border-gray-200 p-4 sm:p-6 rounded-t-3xl">
                    <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center">
                        <div class="mb-4 sm:mb-0">
                            <h2 class="text-xl sm:text-2xl font-bold text-gray-800 mb-1">×¡×¤×¨×™×™×ª ×©×™×¨×™×</h2>
                            <p class="text-gray-600 text-sm sm:text-base">×›×œ ×”×©×™×¨×™× ×•×”×¤×™×•×˜×™× ×‘××¢×¨×›×ª</p>
                        </div>
                        <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-3 sm:space-x-reverse">
                            <input type="text" id="songSearch" placeholder="×—×™×¤×•×© ×©×™×¨..." class="border border-gray-300 rounded-2xl px-3 sm:px-4 py-2 text-gray-700 bg-white shadow-sm text-sm sm:text-base">
                            <button id="toggleCategoriesBtn" onclick="toggleCategories()" class="bg-purple-600 text-white px-4 sm:px-6 py-2 rounded-2xl hover:bg-purple-700 transition-colors font-medium shadow-md text-sm sm:text-base">
                                ğŸ“‚ ×”×¦×’ ×§×˜×’×•×¨×™×•×ª
                            </button>
                            <button id="manageCategoriesBtn" class="bg-orange-600 text-white px-4 sm:px-6 py-2 rounded-2xl hover:bg-orange-700 transition-colors font-medium shadow-md text-sm sm:text-base hidden" onclick="manageCategories()">
                                ğŸ·ï¸ × ×”×œ ×§×˜×’×•×¨×™×•×ª
                            </button>
                            <button id="addSongBtn" class="bg-blue-600 text-white px-4 sm:px-6 py-2 rounded-2xl hover:bg-blue-700 transition-colors font-medium shadow-md text-sm sm:text-base hidden" onclick="addNewSong()">
                                â• ×”×•×¡×£ ×©×™×¨
                            </button>
                        </div>
                    </div>
                </div>
                <div class="p-4 sm:p-6" id="songsLibraryContainer">
                    <!-- Songs library will be populated here -->
                </div>
            </div>
        </div>

        <!-- Important Links Page -->
        <div id="important-links-page" class="page hidden">
            <div class="bg-white rounded-3xl shadow-lg border border-gray-100">
                <div class="bg-gradient-to-l from-cyan-50 to-blue-50 border-b border-gray-200 p-4 sm:p-6 rounded-t-3xl">
                    <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center">
                        <div class="mb-4 sm:mb-0">
                            <h2 class="text-xl sm:text-2xl font-bold text-gray-800 mb-1">×§×™×©×•×¨×™× ×—×©×•×‘×™×</h2>
                            <p class="text-gray-600 text-sm sm:text-base">×§×™×©×•×¨×™× ××”×™×¨×™× ×œ×‘×™×¦×•×¢ ×¤×¢×•×œ×•×ª × ×¤×•×¦×•×ª</p>
                        </div>
                        <button id="addLinkBtn" class="bg-cyan-600 text-white px-4 sm:px-6 py-2 rounded-2xl hover:bg-cyan-700 transition-colors font-medium shadow-md text-sm sm:text-base" onclick="addNewLink()">
                            â• ×”×•×¡×£ ×§×™×©×•×¨
                        </button>
                    </div>
                </div>
                <div class="p-4 sm:p-6" id="importantLinksContainer">
                    <!-- Important links will be populated here -->
                </div>
            </div>
        </div>
    </main>

    <!-- Event Modal -->
    <div id="eventModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-2 sm:p-4">
        <div class="bg-white rounded-3xl shadow-xl max-w-4xl w-full max-h-[95vh] sm:max-h-[90vh] overflow-y-auto">
            <div class="border-b border-gray-200 p-3 sm:p-6 sticky top-0 bg-white rounded-t-3xl">
                <div class="flex justify-between items-center">
                    <h3 class="text-base sm:text-lg md:text-xl font-bold text-gray-800" id="modalTitle">×¤×¨×˜×™ ××™×¨×•×¢</h3>
                    <button id="closeModal" class="text-gray-400 hover:text-gray-600 text-xl sm:text-2xl font-bold p-1 rounded-full hover:bg-gray-100 transition-all">Ã—</button>
                </div>
            </div>
            <div class="p-3 sm:p-6" id="modalContent">
                <!-- Modal content will be populated here -->
            </div>
        </div>
    </div>

    <script>
        // Sample data
        const events = [
            {
                id: 1,
                name: "×“×•×“ ×›×”×Ÿ",
                date: "2024-01-15",
                time: "10:00",
                guestArrivalTime: "09:30",
                eventStartTime: "10:00",
                location: "×‘×™×ª ×›× ×¡×ª ×”×’×“×•×œ, ×ª×œ ××‘×™×‘",
                wazeLink: "https://waze.com/ul?q=×‘×™×ª ×›× ×¡×ª ×”×’×“×•×œ ×ª×œ ××‘×™×‘",
                package: "×—×‘×™×œ×” ×—×’×™×’×™×ª",
                keyboardist: true,
                drummers: 1,
                isStudent: true,
                price: 3500,
                parentPhone: "050-1234567",
                parentName: "××©×” ×›×”×Ÿ",
                notes: "× ×¢×¨ ××•×›×©×¨, ××¢×“×™×£ ×©×™×¨×™× ××–×¨×—×™×™×",
                status: "confirmed",
                mediaLinks: {
                    photos: "https://photos.google.com/share/example1",
                    videos: "https://drive.google.com/folder/example1"
                }
            },
            {
                id: 2,
                name: "×™×•×¡×™ ×œ×•×™",
                date: "2024-01-18",
                time: "09:30",
                guestArrivalTime: "09:00",
                eventStartTime: "09:30",
                location: "×‘×™×ª ×›× ×¡×ª ××•×¨ ×”×—×™×™×, ×™×¨×•×©×œ×™×",
                wazeLink: "https://waze.com/ul?q=×‘×™×ª ×›× ×¡×ª ××•×¨ ×”×—×™×™× ×™×¨×•×©×œ×™×",
                package: "×—×‘×™×œ×” ×‘×¡×™×¡×™×ª",
                keyboardist: false,
                drummers: 0,
                isStudent: false,
                price: 2000,
                parentPhone: "052-9876543",
                parentName: "××‘×¨×”× ×œ×•×™",
                notes: "××©×¤×—×” ×“×ª×™×ª, ×©×™×¨×™× ××¡×•×¨×ª×™×™× ×‘×œ×‘×“",
                status: "confirmed",
                mediaLinks: {
                    photos: "",
                    videos: ""
                }
            },
            {
                id: 3,
                name: "××‘×™ ×¨×•×–×Ÿ",
                date: "2024-01-22",
                time: "11:00",
                guestArrivalTime: "10:30",
                eventStartTime: "11:00",
                location: "××•×œ× ××™×¨×•×¢×™× ×“×™×××•× ×“, ×—×™×¤×”",
                wazeLink: "https://waze.com/ul?q=××•×œ× ××™×¨×•×¢×™× ×“×™×××•× ×“ ×—×™×¤×”",
                package: "×—×‘×™×œ×ª ×”×›×œ ×›×œ×•×œ",
                keyboardist: true,
                drummers: 2,
                isStudent: true,
                price: 5500,
                parentPhone: "054-5555555",
                parentName: "×“× ×™ ×¨×•×–×Ÿ",
                notes: "××™×¨×•×¢ ×’×“×•×œ, 200 ××•×–×× ×™×",
                status: "pending",
                mediaLinks: {
                    photos: "",
                    videos: ""
                }
            }
        ];

        const students = [
            {
                id: 1,
                name: "×“×•×“ ×›×”×Ÿ",
                eventDate: "2024-01-15",
                lessonsCompleted: 8,
                totalLessons: 12,
                nextLesson: "2024-01-10",
                phone: "050-1234567",
                progress: "××ª×§×“× ××¦×•×™×Ÿ, ××•×›×Ÿ ×œ×§×¨×™××” ×‘×ª×•×¨×”",
                parsha: "×¤×¨×©×ª ×•×™×¨×",
                readingType: "×¢×œ×™×™×ª ×¨××©×•×Ÿ + ××¤×˜×™×¨",
                hasRecording: true,
                recordingNotes: "×”×§×œ×˜×” ×©×œ ×”×¤×¨×©×” ×•×”×¤×˜×¨×”",
                haftarah: "××œ×›×™× × ×™×—:×›-×œ×˜",
                torahPortion: "×‘×¨××©×™×ª ×›×‘:×-×™×˜",
                specialNotes: "×™×•×“×¢ ×œ×§×¨×•× ×¢× ×˜×¢××™×, ×§×•×œ ×™×¤×”"
            },
            {
                id: 3,
                name: "××‘×™ ×¨×•×–×Ÿ",
                eventDate: "2024-01-22",
                lessonsCompleted: 6,
                totalLessons: 15,
                nextLesson: "2024-01-12",
                phone: "054-5555555",
                progress: "×¦×¨×™×š ×¢×‘×•×“×” × ×•×¡×¤×ª ×¢×œ ×”×¤×˜×¨×”",
                parsha: "×¤×¨×©×ª ×—×™×™ ×©×¨×”",
                readingType: "×¢×œ×™×™×ª ×¨××©×•×Ÿ ×‘×œ×‘×“",
                hasRecording: false,
                recordingNotes: "×¢×“×™×™×Ÿ ×œ× ××•×›×Ÿ ×œ×”×§×œ×˜×”",
                haftarah: "××œ×›×™× × ×:×-×œ×",
                torahPortion: "×‘×¨××©×™×ª ×›×’:×-×›",
                specialNotes: "×§×•×©×™ ×‘×˜×¢××™×, ×¦×¨×™×š ×ª×¨×’×•×œ × ×•×¡×£"
            }
        ];

        const prayerSongs = [
            {
                id: 1,
                name: "×©××¢ ×™×©×¨××œ",
                key: "Am",
                tempo: 120,
                transpose: 0,
                chords: "Am - F - C - G",
                lyrics: "×©××¢ ×™×©×¨××œ ×”' ××œ×•×”×™× ×• ×”' ××—×“\n×‘×¨×•×š ×©× ×›×‘×•×“ ××œ×›×•×ª×• ×œ×¢×•×œ× ×•×¢×“",
                category: "×ª×¤×™×œ×”"
            },
            {
                id: 2,
                name: "×‘×¨×›×•",
                key: "Dm",
                tempo: 90,
                transpose: 2,
                chords: "Dm - Bb - F - C",
                lyrics: "×‘×¨×›×• ××ª ×”' ×”××‘×•×¨×š\n×‘×¨×•×š ×”' ×”××‘×•×¨×š ×œ×¢×•×œ× ×•×¢×“",
                category: "×›× ×™×¡×”"
            },
            {
                id: 3,
                name: "×™×’×“×œ",
                key: "G",
                tempo: 110,
                transpose: -1,
                chords: "G - Em - C - D",
                lyrics: "×™×’×“×œ ××œ×•×”×™× ×—×™ ×•×™×© ×ª×”×œ×œ\n× ××¦× ×•××™×Ÿ ×¢×ª ××œ ××¦×™××•×ª×•",
                category: "×ª×¤×™×œ×”"
            },
            {
                id: 4,
                name: "××“×•×Ÿ ×¢×•×œ×",
                key: "C",
                tempo: 100,
                transpose: 3,
                chords: "C - Am - F - G",
                lyrics: "××“×•×Ÿ ×¢×•×œ× ××©×¨ ××œ×š\n×‘×˜×¨× ×›×œ ×™×¦×™×¨ × ×‘×¨×",
                category: "×ª×¤×™×œ×”"
            },
            {
                id: 5,
                name: "×œ×›×” ×“×•×“×™",
                key: "Em",
                tempo: 85,
                transpose: 0,
                chords: "Em - C - G - D",
                lyrics: "×œ×›×” ×“×•×“×™ ×œ×§×¨××ª ×›×œ×”\n×¤× ×™ ×©×‘×ª × ×§×‘×œ×”",
                category: "×›× ×™×¡×”"
            }
        ];

        const mealSongs = [
            {
                id: 1,
                name: "×©×œ×•× ×¢×œ×™×›×",
                key: "D",
                tempo: 95,
                transpose: 1,
                chords: "D - A - Bm - G",
                lyrics: "×©×œ×•× ×¢×œ×™×›× ××œ××›×™ ×”×©×¨×ª\n××œ××›×™ ×¢×œ×™×•×Ÿ",
                category: "×¡×¢×•×“×”"
            },
            {
                id: 2,
                name: "××©×ª ×—×™×œ",
                key: "F",
                tempo: 80,
                transpose: -2,
                chords: "F - Dm - Bb - C",
                lyrics: "××©×ª ×—×™×œ ××™ ×™××¦×\n×•×¨×—×•×§ ××¤× ×™× ×™× ××›×¨×”",
                category: "×¡×¢×•×“×”"
            },
            {
                id: 3,
                name: "×‘×¨×›×ª ×”××–×•×Ÿ",
                key: "A",
                tempo: 105,
                transpose: 4,
                chords: "A - F#m - D - E",
                lyrics: "×‘×¨×•×š ××ª×” ×”' ××œ×•×”×™× ×• ××œ×š ×”×¢×•×œ×\n×”×–×Ÿ ××ª ×”×¢×•×œ× ×›×•×œ×•",
                category: "×‘×¨×›×•×ª"
            },
            {
                id: 4,
                name: "×”×‘×“×œ×”",
                key: "Bm",
                tempo: 75,
                transpose: 0,
                chords: "Bm - G - D - A",
                lyrics: "×”× ×” ××œ ×™×©×•×¢×ª×™ ××‘×˜×— ×•×œ× ××¤×—×“\n×›×™ ×¢×–×™ ×•×–××¨×ª ×™×” ×”'",
                category: "×”×‘×“×œ×”"
            }
        ];

        const equipment = [
            { id: 1, item: "××™×§×¨×•×¤×•×Ÿ ××œ×—×•×˜×™", checked: false, category: "×§×•×œ" },
            { id: 2, item: "××¢×¨×›×ª ×”×’×‘×¨×”", checked: false, category: "×§×•×œ" },
            { id: 3, item: "×§×œ×™×“×™×", checked: false, category: "×›×œ×™ × ×’×™× ×”" },
            { id: 4, item: "×ª×•×¤×™×", checked: false, category: "×›×œ×™ × ×’×™× ×”" },
            { id: 5, item: "×›×‘×œ×™×", checked: false, category: "×˜×›× ×™" },
            { id: 6, item: "××ª×× ×—×©××œ", checked: false, category: "×˜×›× ×™" },
            { id: 7, item: "×¢××“×ª ×ª×•×•×™×", checked: false, category: "××‘×™×–×¨×™×" },
            { id: 8, item: "×›×™×¡× ×œ×§×œ×™×“×Ÿ", checked: false, category: "××‘×™×–×¨×™×" },
            { id: 9, item: "××—×©×‘ × ×™×™×“", checked: false, category: "×˜×›× ×™" },
            { id: 10, item: "×¨××§×•×œ×™×", checked: false, category: "×§×•×œ" }
        ];

        const payments = [
            { 
                id: 1, 
                eventName: "×“×•×“ ×›×”×Ÿ", 
                keyboardistPaid: true, 
                keyboardistAmount: 800,
                drummersPaid: false, 
                drummersAmount: 0,
                receiptIssued: true, 
                managerPaid: true,
                managerAmount: 1500
            },
            { 
                id: 2, 
                eventName: "×™×•×¡×™ ×œ×•×™", 
                keyboardistPaid: false, 
                keyboardistAmount: 0,
                drummersPaid: false, 
                drummersAmount: 0,
                receiptIssued: false, 
                managerPaid: false,
                managerAmount: 0
            },
            { 
                id: 3, 
                eventName: "××‘×™ ×¨×•×–×Ÿ", 
                keyboardistPaid: true, 
                keyboardistAmount: 1000,
                drummersPaid: true, 
                drummersAmount: 1200,
                receiptIssued: false, 
                managerPaid: true,
                managerAmount: 2000
            }
        ];

        // Important links data
        const importantLinks = [
            {
                id: 1,
                name: "×™×© ×—×©×‘×•× ×™×ª - ×”×•×¦××ª ×§×‘×œ×”",
                url: "https://www.ishhashounit.co.il",
                description: "××¢×¨×›×ª ×œ×”×•×¦××ª ×§×‘×œ×•×ª ×•××¢×§×‘ ×”×›× ×¡×•×ª",
                category: "×›×¡×¤×™×",
                icon: "ğŸ§¾"
            },
            {
                id: 2,
                name: "×™×© ×—×©×‘×•× ×™×ª - ×”×–×× ×” ×—×“×©×”",
                url: "https://www.ishhashounit.co.il/new-order",
                description: "×¤×ª×™×—×ª ×”×–×× ×” ×—×“×©×” ×‘××¢×¨×›×ª",
                category: "×›×¡×¤×™×",
                icon: "ğŸ“"
            },
            {
                id: 3,
                name: "Google Calendar",
                url: "https://calendar.google.com",
                description: "× ×™×”×•×œ ×œ×•×— ×©× ×” ×•×ª×–××•×Ÿ ××™×¨×•×¢×™×",
                category: "× ×™×”×•×œ ×–××Ÿ",
                icon: "ğŸ“…"
            },
            {
                id: 4,
                name: "WhatsApp Web",
                url: "https://web.whatsapp.com",
                description: "×©×œ×™×—×ª ×”×•×“×¢×•×ª ×œ×œ×§×•×—×•×ª",
                category: "×ª×§×©×•×¨×ª",
                icon: "ğŸ“±"
            }
        ];

        // Calendar data
        const lessons = [
            { id: 1, studentName: "×“×•×“ ×›×”×Ÿ", date: "2024-01-10", time: "16:00", duration: 60, type: "lesson", status: "scheduled" },
            { id: 2, studentName: "××‘×™ ×¨×•×–×Ÿ", date: "2024-01-12", time: "17:00", duration: 60, type: "lesson", status: "scheduled" },
            { id: 3, studentName: "×“×•×“ ×›×”×Ÿ", date: "2024-01-15", time: "10:00", duration: 180, type: "event", status: "confirmed" }
        ];

        const blockedDates = [
            { date: "2024-01-20", reason: "×—×•×¤×©" },
            { date: "2024-01-25", reason: "××™×¨×•×¢ ××™×©×™" }
        ];

        // Communication data
        const messageTemplates = [
            { id: 1, name: "×ª×–×›×•×¨×ª ×œ×©×™×¢×•×¨", content: "×©×œ×•× {name}, ×ª×–×›×•×¨×ª ×œ×©×™×¢×•×¨ ××—×¨ ×‘-{time}. × ×ª×¨××”!" },
            { id: 2, name: "×ª×–×›×•×¨×ª ×œ××™×¨×•×¢", content: "×©×œ×•× {parentName}, ×ª×–×›×•×¨×ª ×œ×‘×¨ ×”××¦×•×•×” ×©×œ {studentName} ×‘-{date} ×‘-{time}. ×‘×”×¦×œ×—×”!" },
            { id: 3, name: "×‘×™×˜×•×œ ×©×™×¢×•×¨", content: "×©×œ×•× {name}, ×¦×¨ ×œ×™ ××‘×œ ×× ×™ ×¦×¨×™×š ×œ×‘×˜×œ ××ª ×”×©×™×¢×•×¨ ×©×œ {date}. × ×ª×× ×ª××¨×™×š ×—×“×©." },
            { id: 4, name: "×¨×©×™××ª ×©×™×¨×™×", content: "×©×œ×•× {parentName}, ××¦×•×¨×¤×ª ×¨×©×™××ª ×”×©×™×¨×™× ×œ×‘×¨ ×”××¦×•×•×” ×©×œ {studentName}: {songsList}" }
        ];

        const messageHistory = [
            { id: 1, recipient: "×“×•×“ ×›×”×Ÿ", phone: "050-1234567", message: "×©×œ×•× ×“×•×“, ×ª×–×›×•×¨×ª ×œ×©×™×¢×•×¨ ××—×¨ ×‘-16:00. × ×ª×¨××”!", sent: "2024-01-09 15:30", status: "sent" },
            { id: 2, recipient: "××©×” ×›×”×Ÿ (×”×•×¨×”)", phone: "050-1234567", message: "×©×œ×•× ××©×”, ×ª×–×›×•×¨×ª ×œ×‘×¨ ×”××¦×•×•×” ×©×œ ×“×•×“ ×‘-15/01 ×‘-10:00. ×‘×”×¦×œ×—×”!", sent: "2024-01-14 09:00", status: "delivered" }
        ];

        // Song categories management
        const songCategories = [
            { id: 1, name: '×›× ×™×¡×”', color: 'blue', icon: 'ğŸšª' },
            { id: 2, name: '×ª×¤×™×œ×”', color: 'purple', icon: 'ğŸ™' },
            { id: 3, name: '×”×•×¦××ª ×¡×¤×¨ ×ª×•×¨×”', color: 'amber', icon: 'ğŸ“œ' },
            { id: 4, name: '×‘×¨×›×•×ª', color: 'green', icon: 'ğŸ¤²' },
            { id: 5, name: '×¡×¢×•×“×”', color: 'orange', icon: 'ğŸ½ï¸' },
            { id: 6, name: '×”×‘×“×œ×”', color: 'indigo', icon: 'ğŸ•¯ï¸' },
            { id: 7, name: '×—×ª×•× ×”', color: 'pink', icon: 'ğŸ’’' },
            { id: 8, name: '××–××•×¨×™×', color: 'teal', icon: 'ğŸ“–' },
            { id: 9, name: '×›×œ×œ×™', color: 'gray', icon: 'ğŸµ' }
        ];

        // Extended songs library
        const songsLibrary = [
            ...prayerSongs.map(song => ({...song, category: "×ª×¤×™×œ×”"})),
            ...mealSongs.map(song => ({...song, category: "×¡×¢×•×“×”"})),
            { id: 101, name: "×¢×•×“ ×™×©××¢", key: "Em", tempo: 130, transpose: 0, chords: "Em - C - G - D", lyrics: "×¢×•×“ ×™×©××¢ ×‘×¢×¨×™ ×™×”×•×“×”\n×•×‘×—×•×¦×•×ª ×™×¨×•×©×œ×™×", category: "×—×ª×•× ×”", youtubeLink: "https://youtube.com/watch?v=example1" },
            { id: 102, name: "×× ××©×›×—×š", key: "Am", tempo: 85, transpose: 2, chords: "Am - F - C - G", lyrics: "×× ××©×›×—×š ×™×¨×•×©×œ×™×\n×ª×©×›×— ×™××™× ×™", category: "××–××•×¨×™×", youtubeLink: "https://youtube.com/watch?v=example2" },
            { id: 103, name: "×”×‘×“×œ×” ××œ×•×“×™", key: "D", tempo: 95, transpose: -1, chords: "D - A - Bm - G", lyrics: "×”× ×” ××œ ×™×©×•×¢×ª×™\n××‘×˜×— ×•×œ× ××¤×—×“", category: "×”×‘×“×œ×”", youtubeLink: "https://youtube.com/watch?v=example3" }
        ];

        const playlists = [
            { id: 1, name: "×‘×¨ ××¦×•×•×” ×§×œ××¡×™", songs: [1, 2, 3, 101], eventType: "×‘×¨ ××¦×•×•×”", description: "×¨×©×™××ª ×©×™×¨×™× ××¡×•×¨×ª×™×ª ×œ×‘×¨ ××¦×•×•×”" },
            { id: 2, name: "×©×™×¨×™ ×©×‘×ª", songs: [5, 102, 103], eventType: "×©×‘×ª", description: "×©×™×¨×™× ×œ×§×‘×œ×ª ×©×‘×ª ×•×©×‘×ª" },
            { id: 3, name: "×¡×¢×•×“×” ×—×’×™×’×™×ª", songs: [6, 7, 8, 101], eventType: "×¡×¢×•×“×”", description: "×©×™×¨×™× ×œ×¡×¢×•×“×” ×—×’×™×’×™×ª" }
        ];

        // Unified data structure for Decap CMS
        const systemData = {
            events: events,
            students: students,
            prayerSongs: prayerSongs,
            mealSongs: mealSongs,
            equipment: equipment,
            payments: payments,
            lessons: lessons,
            blockedDates: blockedDates,
            messageTemplates: messageTemplates,
            messageHistory: messageHistory,
            songsLibrary: songsLibrary,
            playlists: playlists,
            songCategories: songCategories,
            importantLinks: importantLinks,
            lastUpdated: new Date().toISOString()
        };

        let isLoggedIn = false;
        let currentPage = 'events';
        let filteredEvents = [...events];
        let showCategories = false;
        let showPrayerCategories = false;
        let showMealCategories = false;

        // Authentication setup
        let auth0Client;
        let currentAuthProvider = null;

        // Initialize Auth0
        async function initAuth0() {
            try {
                auth0Client = await auth0.createAuth0Client({
                    domain: 'dev-xq17rgh1xskeyxfa.us.auth0.com',
                    clientId: 'F4UbYRfwBHLlbkFCHUxu6UYs3dn3z2A4',
                    authorizationParams: {
                        redirect_uri: window.location.origin,
                        scope: 'openid profile email'
                    }
                });
                console.log('Auth0 initialized successfully');
            } catch (error) {
                console.log('Auth0 initialization failed:', error);
                auth0Client = null;
            }
        }

        // DOM Elements
        const loginBtn = document.getElementById('loginBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const editContentBtn = document.getElementById('editContentBtn');
        const userInfo = document.getElementById('userInfo');
        const loginSection = document.getElementById('loginSection');
        const eventsContainer = document.getElementById('eventsContainer');
        const studentsContainer = document.getElementById('studentsContainer');
        const eventModal = document.getElementById('eventModal');
        const closeModal = document.getElementById('closeModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalContent = document.getElementById('modalContent');
        const menuBtn = document.getElementById('menuBtn');
        const sidebar = document.getElementById('sidebar');
        const closeSidebarBtn = document.getElementById('closeSidebar');
        const overlay = document.getElementById('overlay');

        // Filter elements
        const packageFilter = document.getElementById('packageFilter');
        const keyboardistFilter = document.getElementById('keyboardistFilter');
        const drummersFilter = document.getElementById('drummersFilter');

        // Event Listeners
        loginBtn.addEventListener('click', auth0Login);
        logoutBtn.addEventListener('click', logout);
        editContentBtn.addEventListener('click', openDecapCMS);
        closeModal.addEventListener('click', () => eventModal.classList.add('hidden'));
        menuBtn.addEventListener('click', openSidebar);
        closeSidebarBtn.addEventListener('click', closeSidebar);

        // Filter event listeners
        packageFilter.addEventListener('change', applyFilters);
        keyboardistFilter.addEventListener('change', applyFilters);
        drummersFilter.addEventListener('change', applyFilters);

        // Functions
        function login() {
            isLoggedIn = true;
            loginSection.classList.add('hidden');
            userInfo.classList.remove('hidden');
            
            // Show admin sections
            document.getElementById('adminSection').classList.remove('hidden');
            document.getElementById('equipmentSection').classList.remove('hidden');
            document.getElementById('paymentsSection').classList.remove('hidden');
            document.getElementById('songsLibrarySection').classList.remove('hidden');
            document.getElementById('importantLinksSection').classList.remove('hidden');
            
            // Show add event button
            const addEventBtn = document.getElementById('addEventBtn');
            if (addEventBtn) {
                addEventBtn.classList.remove('hidden');
            }
            
            // Show add song button
            const addSongBtn = document.getElementById('addSongBtn');
            if (addSongBtn) {
                addSongBtn.classList.remove('hidden');
            }
            
            // Show manage categories button
            const manageCategoriesBtn = document.getElementById('manageCategoriesBtn');
            if (manageCategoriesBtn) {
                manageCategoriesBtn.classList.remove('hidden');
            }
            
            renderCurrentPage();
        }

        async function auth0Login() {
            try {
                if (auth0Client) {
                    console.log('××ª×—×™×œ ×”×ª×—×‘×¨×•×ª Auth0...');
                    
                    await auth0Client.loginWithRedirect({
                        authorizationParams: {
                            redirect_uri: window.location.origin,
                            scope: 'openid profile email'
                        }
                    });
                    
                } else {
                    console.log('Auth0 ×œ× ×–××™×Ÿ - ×× ×¡×” ×œ××ª×—×œ ××—×“×©...');
                    await initAuth0();
                    if (auth0Client) {
                        await auth0Login();
                    } else {
                        console.log('Auth0 ×œ× ×–××™×Ÿ - ××ª×—×‘×¨ ×œ×œ× ××™××•×ª ×—×™×¦×•× ×™');
                        login();
                        currentAuthProvider = 'local';
                        showNotification('×”×ª×—×‘×¨×ª ×‘×”×¦×œ×—×” (××¦×‘ ××§×•××™)', 'success');
                    }
                }
            } catch (error) {
                console.error('Auth0 login error:', error);
                console.log('× ×›×©×œ Auth0 - ×¢×•×‘×¨ ×œ××¦×‘ ××§×•××™');
                
                login();
                currentAuthProvider = 'local';
                showNotification('×”×ª×—×‘×¨×ª ×‘×”×¦×œ×—×” (××¦×‘ ××§×•××™)', 'info');
            }
        }

        function openDecapCMS() {
            const cmsConfig = {
                backend: {
                    name: 'git-gateway',
                    branch: 'main'
                },
                media_folder: 'static/images',
                public_folder: '/images',
                collections: [
                    {
                        name: 'events',
                        label: '××™×¨×•×¢×™×',
                        folder: 'content/events',
                        create: true,
                        slug: '{{year}}-{{month}}-{{day}}-{{slug}}',
                        fields: [
                            { label: '×©× ×‘×¨ ×”××¦×•×•×”', name: 'name', widget: 'string' },
                            { label: '×ª××¨×™×š', name: 'date', widget: 'datetime' },
                            { label: '××™×§×•×', name: 'location', widget: 'string' },
                            { label: '×—×‘×™×œ×”', name: 'package', widget: 'select', options: ['×—×‘×™×œ×” ×‘×¡×™×¡×™×ª', '×—×‘×™×œ×” ×—×’×™×’×™×ª', '×—×‘×™×œ×ª ×”×›×œ ×›×œ×•×œ'] },
                            { label: '×§×œ×™×“×Ÿ', name: 'keyboardist', widget: 'boolean', default: false },
                            { label: '××¡×¤×¨ ××ª×•×¤×¤×™×', name: 'drummers', widget: 'number', default: 0 },
                            { label: '××—×™×¨', name: 'price', widget: 'number' },
                            { label: '×©× ×”×”×•×¨×”', name: 'parentName', widget: 'string' },
                            { label: '×˜×œ×¤×•×Ÿ', name: 'parentPhone', widget: 'string' },
                            { label: '×”×¢×¨×•×ª', name: 'notes', widget: 'text', required: false }
                        ]
                    }
                ]
            };

            if (window.CMS) {
                window.CMS.init({ config: cmsConfig });
                window.open('/admin/', '_blank');
            } else {
                alert('Decap CMS ×œ× ×–××™×Ÿ. ×× × ×‘×“×•×§ ××ª ×”×”×’×“×¨×•×ª.');
            }
        }

        async function logout() {
            try {
                if (currentAuthProvider === 'auth0' && auth0Client) {
                    await auth0Client.logout({
                        logoutParams: {
                            returnTo: window.location.origin
                        }
                    });
                } else {
                    performLogout();
                }
            } catch (error) {
                console.error('Logout error:', error);
                performLogout();
            }
        }

        function performLogout() {
            isLoggedIn = false;
            loginSection.classList.remove('hidden');
            userInfo.classList.add('hidden');
            currentAuthProvider = null;
            
            document.getElementById('adminSection').classList.add('hidden');
            document.getElementById('equipmentSection').classList.add('hidden');
            document.getElementById('paymentsSection').classList.add('hidden');
            document.getElementById('songsLibrarySection').classList.add('hidden');
            document.getElementById('importantLinksSection').classList.add('hidden');
            
            const addEventBtn = document.getElementById('addEventBtn');
            if (addEventBtn) {
                addEventBtn.classList.add('hidden');
            }
            
            const addSongBtn = document.getElementById('addSongBtn');
            if (addSongBtn) {
                addSongBtn.classList.add('hidden');
            }
            
            const manageCategoriesBtn = document.getElementById('manageCategoriesBtn');
            if (manageCategoriesBtn) {
                manageCategoriesBtn.classList.add('hidden');
            }
            
            renderCurrentPage();
        }

        function openSidebar() {
            sidebar.classList.add('open');
            overlay.classList.remove('hidden');
        }

        function closeSidebar() {
            sidebar.classList.remove('open');
            overlay.classList.add('hidden');
        }

        function showPage(page) {
            document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
            document.getElementById(page + '-page').classList.remove('hidden');
            
            currentPage = page;
            renderCurrentPage();
            closeSidebar();
        }

        function renderCurrentPage() {
            switch(currentPage) {
                case 'events':
                    renderEvents();
                    break;
                case 'prayer-songs':
                    renderPrayerSongs();
                    break;
                case 'meal-songs':
                    renderMealSongs();
                    break;
                case 'admin':
                    if (isLoggedIn) renderStudents();
                    break;
                case 'equipment':
                    if (isLoggedIn) renderEquipment();
                    break;
                case 'payments':
                    if (isLoggedIn) renderPayments();
                    break;
                case 'songs-library':
                    if (isLoggedIn) renderSongsLibrary();
                    break;
                case 'important-links':
                    if (isLoggedIn) renderImportantLinks();
                    break;
            }
        }

        function applyFilters() {
            const packageValue = packageFilter.value;
            const keyboardistValue = keyboardistFilter.value;
            const drummersValue = drummersFilter.value;

            filteredEvents = events.filter(event => {
                let matches = true;

                if (packageValue && event.package !== packageValue) {
                    matches = false;
                }

                if (keyboardistValue !== '') {
                    const hasKeyboardist = keyboardistValue === 'true';
                    if (event.keyboardist !== hasKeyboardist) {
                        matches = false;
                    }
                }

                if (drummersValue !== '') {
                    const hasDrummers = drummersValue === 'true';
                    if ((event.drummers > 0) !== hasDrummers) {
                        matches = false;
                    }
                }

                return matches;
            });

            renderEvents();
        }

        function renderEvents() {
            eventsContainer.innerHTML = filteredEvents.map((event, index) => {
                const eventDate = new Date(event.date);
                const formattedDate = eventDate.toLocaleDateString('he-IL', {
                    day: 'numeric',
                    month: 'long',
                    year: 'numeric'
                });

                const statusColors = {
                    'confirmed': 'bg-green-500',
                    'pending': 'bg-yellow-500'
                };

                const gradientClass = `card-gradient-${(index % 6) + 1}`;

                return `
                    <div class="bg-white border border-gray-200 rounded-3xl shadow-lg hover:shadow-xl transition-all duration-300 cursor-pointer overflow-hidden" onclick="openEventModal(${event.id})">
                        <div class="${gradientClass} p-4 text-white">
                            <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center">
                                <div class="flex items-center mb-2 sm:mb-0">
                                    <span class="status-indicator ${statusColors[event.status]} ml-3 bg-white bg-opacity-80"></span>
                                    <h3 class="text-lg sm:text-xl font-bold">×‘×¨ ××¦×•×•×” - ${event.name}</h3>
                                </div>
                                ${event.isStudent ? '<span class="bg-white bg-opacity-20 text-white px-3 py-1 rounded-full text-xs font-medium self-start sm:self-center">×ª×œ××™×“ ×¤×¨×˜×™</span>' : ''}
                            </div>
                        </div>

                        <div class="p-4 sm:p-5">
                            <div class="flex flex-col lg:flex-row lg:justify-between lg:items-center">
                                <div class="flex-1 mb-4 lg:mb-0">
                                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 text-gray-600">
                                        <div class="bg-blue-50 p-3 rounded-2xl border border-blue-200 cursor-pointer hover:bg-blue-100 transition-colors" onclick="event.stopPropagation(); addToGoogleCalendar(${event.id})">
                                            <div class="flex items-center">
                                                <span class="text-blue-600 ml-2 text-lg">ğŸ“…</span>
                                                <div class="flex flex-col">
                                                    <span class="text-xs text-blue-600 font-medium">×ª××¨×™×š</span>
                                                    <span class="font-bold text-blue-800 text-sm">${formattedDate}</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="bg-green-50 p-3 rounded-2xl border border-green-200">
                                            <div class="flex items-center">
                                                <span class="text-green-600 ml-2 text-lg">ğŸ‘¥</span>
                                                <div class="flex flex-col">
                                                    <span class="text-xs text-green-600 font-medium">×”×’×¢×ª ××•×¨×—×™×</span>
                                                    <span class="font-bold text-green-800 text-sm">${event.guestArrivalTime || event.time}</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="bg-orange-50 p-3 rounded-2xl border border-orange-200">
                                            <div class="flex items-center">
                                                <span class="text-orange-600 ml-2 text-lg">ğŸ‰</span>
                                                <div class="flex flex-col">
                                                    <span class="text-xs text-orange-600 font-medium">×ª×—×™×œ×ª ××™×¨×•×¢</span>
                                                    <span class="font-bold text-orange-800 text-sm">${event.eventStartTime || event.time}</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="bg-purple-50 p-3 rounded-2xl border border-purple-200 cursor-pointer hover:bg-purple-100 transition-colors" onclick="event.stopPropagation(); openWaze('${event.wazeLink}')">
                                            <div class="flex items-start">
                                                <span class="text-purple-600 ml-2 text-lg flex-shrink-0">ğŸ“</span>
                                                <div class="flex flex-col flex-1 min-w-0">
                                                    <span class="text-xs text-purple-600 font-medium">××™×§×•×</span>
                                                    <span class="font-bold text-purple-800 text-sm text-right break-words leading-tight">
                                                        ${event.location}
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="flex flex-col sm:flex-row items-start sm:items-center space-y-2 sm:space-y-0 sm:space-x-3 sm:space-x-reverse">
                                    ${isLoggedIn ? `
                                        <div class="flex space-x-2 space-x-reverse">
                                            <button onclick="event.stopPropagation(); openYeshInvoice()" class="bg-blue-600 text-white px-3 py-2 rounded-2xl text-sm hover:bg-blue-700 transition-colors font-medium flex items-center">
                                                <span class="ml-1">ğŸ§¾</span>
                                                <span>×™×© ×—×©×‘×•× ×™×ª</span>
                                            </button>
                                            <button onclick="event.stopPropagation(); sendWhatsAppToParent('${event.parentPhone}', '${event.parentName}', '${event.name}')" class="bg-green-600 text-white px-3 py-2 rounded-2xl text-sm hover:bg-green-700 transition-colors font-medium flex items-center">
                                                <span class="ml-1">ğŸ“±</span>
                                                <span>WhatsApp</span>
                                            </button>
                                        </div>
                                    ` : ''}
                                    <div class="flex items-center text-blue-600 hover:text-blue-800 font-medium text-sm bg-blue-50 px-3 py-2 rounded-2xl hover:bg-blue-100 transition-colors">
                                        <span>×¤×¨×˜×™× × ×•×¡×¤×™×</span>
                                        <span class="mr-2">â†</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderPrayerSongs() {
            const container = document.getElementById('prayerSongsContainer');
            
            // Add view toggle buttons
            const viewToggleHTML = `
                <div class="mb-6 flex justify-center">
                    <div class="bg-white rounded-2xl p-1 shadow-sm border border-gray-200">
                        <button id="prayerCategoriesBtn" onclick="togglePrayerView('categories')" class="px-4 py-2 rounded-xl text-sm font-medium transition-colors ${showPrayerCategories ? 'bg-purple-600 text-white' : 'text-gray-600 hover:bg-gray-100'}">
                            ğŸ“‚ ×§×˜×’×•×¨×™×•×ª
                        </button>
                        <button id="prayerListBtn" onclick="togglePrayerView('list')" class="px-4 py-2 rounded-xl text-sm font-medium transition-colors ${!showPrayerCategories ? 'bg-purple-600 text-white' : 'text-gray-600 hover:bg-gray-100'}">
                            ğŸ“‹ ×¨×©×™××”
                        </button>
                    </div>
                </div>
            `;
            
            if (showPrayerCategories) {
                renderPrayerSongsWithCategories(container, viewToggleHTML);
            } else {
                renderPrayerSongsAsList(container, viewToggleHTML);
            }
        }

        function renderPrayerSongsWithCategories(container, viewToggleHTML) {
            const categories = {};
            prayerSongs.forEach(song => {
                const category = song.category || '×›×œ×œ×™';
                if (!categories[category]) {
                    categories[category] = [];
                }
                categories[category].push(song);
            });

            const categoryOrder = ['×›× ×™×¡×”', '×ª×¤×™×œ×”', '×”×•×¦××ª ×¡×¤×¨ ×ª×•×¨×”', '×‘×¨×›×•×ª', '×›×œ×œ×™'];
            
            container.innerHTML = viewToggleHTML + `
                <div class="space-y-6">
                    ${categoryOrder.filter(cat => categories[cat]).map(category => `
                        <div class="bg-purple-50 rounded-3xl p-6 border border-purple-200">
                            <h3 class="text-xl font-bold text-purple-800 mb-4 flex items-center">
                                <span class="w-4 h-4 bg-purple-500 rounded-full ml-3"></span>
                                ${category} (${categories[category].length})
                            </h3>
                            <div class="grid grid-cols-1 gap-4">
                                ${categories[category].map(song => renderPrayerSongCard(song)).join('')}
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function renderPrayerSongsAsList(container, viewToggleHTML) {
            container.innerHTML = viewToggleHTML + `
                <div class="space-y-4">
                    ${prayerSongs.map(song => renderPrayerSongCard(song)).join('')}
                </div>
            `;
        }

        function renderPrayerSongCard(song) {
            const titleFontSize = song.name.length > 15 ? 'text-base' : song.name.length > 10 ? 'text-lg' : 'text-xl';
            
            return `
                <div class="song-card rounded-3xl shadow-sm hover:shadow-md transition-all overflow-hidden">
                    <div class="p-4 cursor-pointer hover:bg-gray-50 transition-colors" onclick="toggleSongDetails('prayer-${song.id}')">
                        <div class="flex justify-between items-center">
                            <div class="flex items-center flex-1 min-w-0">
                                <span class="text-blue-600 ml-3 text-lg flex-shrink-0">ğŸµ</span>
                                <h3 class="${titleFontSize} font-bold text-gray-800 truncate">${song.name}</h3>
                            </div>
                            <div class="flex items-center space-x-2 space-x-reverse flex-shrink-0">
                                <span class="bg-blue-100 text-blue-700 px-2 py-1 rounded-full text-xs font-medium">${song.key}</span>
                                <span class="text-gray-400 text-xl" id="prayer-${song.id}-arrow">â–¼</span>
                            </div>
                        </div>
                    </div>
                    <div id="prayer-${song.id}-details" class="hidden border-t border-gray-200 p-4 bg-gray-50">
                        <div class="flex space-x-2 space-x-reverse mb-4">
                            <span class="bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-sm font-medium">${song.key}</span>
                            <span class="bg-green-100 text-green-700 px-3 py-1 rounded-full text-sm font-medium">${song.tempo} BPM</span>
                            ${song.transpose !== 0 ? `<span class="bg-purple-100 text-purple-700 px-3 py-1 rounded-full text-sm font-medium">${song.transpose > 0 ? '+' : ''}${song.transpose}</span>` : ''}
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <h4 class="font-semibold text-gray-700 mb-2">××§×•×¨×“×™×:</h4>
                                <p class="text-gray-600 bg-white p-3 rounded-2xl font-mono border">${song.chords}</p>
                            </div>
                            <div>
                                <h4 class="font-semibold text-gray-700 mb-2">××™×œ×™×:</h4>
                                <p class="text-gray-600 bg-white p-3 rounded-2xl whitespace-pre-line border">${song.lyrics}</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderMealSongs() {
            const container = document.getElementById('mealSongsContainer');
            
            // Add view toggle buttons
            const viewToggleHTML = `
                <div class="mb-6 flex justify-center">
                    <div class="bg-white rounded-2xl p-1 shadow-sm border border-gray-200">
                        <button id="mealCategoriesBtn" onclick="toggleMealView('categories')" class="px-4 py-2 rounded-xl text-sm font-medium transition-colors ${showMealCategories ? 'bg-green-600 text-white' : 'text-gray-600 hover:bg-gray-100'}">
                            ğŸ“‚ ×§×˜×’×•×¨×™×•×ª
                        </button>
                        <button id="mealListBtn" onclick="toggleMealView('list')" class="px-4 py-2 rounded-xl text-sm font-medium transition-colors ${!showMealCategories ? 'bg-green-600 text-white' : 'text-gray-600 hover:bg-gray-100'}">
                            ğŸ“‹ ×¨×©×™××”
                        </button>
                    </div>
                </div>
            `;
            
            if (showMealCategories) {
                renderMealSongsWithCategories(container, viewToggleHTML);
            } else {
                renderMealSongsAsList(container, viewToggleHTML);
            }
        }

        function renderMealSongsWithCategories(container, viewToggleHTML) {
            const categories = {};
            mealSongs.forEach(song => {
                const category = song.category || '×›×œ×œ×™';
                if (!categories[category]) {
                    categories[category] = [];
                }
                categories[category].push(song);
            });

            const categoryOrder = ['×¡×¢×•×“×”', '×‘×¨×›×•×ª', '×”×‘×“×œ×”', '×›×œ×œ×™'];
            
            container.innerHTML = viewToggleHTML + `
                <div class="space-y-6">
                    ${categoryOrder.filter(cat => categories[cat]).map(category => `
                        <div class="bg-green-50 rounded-3xl p-6 border border-green-200">
                            <h3 class="text-xl font-bold text-green-800 mb-4 flex items-center">
                                <span class="w-4 h-4 bg-green-500 rounded-full ml-3"></span>
                                ${category} (${categories[category].length})
                            </h3>
                            <div class="grid grid-cols-1 gap-4">
                                ${categories[category].map(song => renderMealSongCard(song)).join('')}
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function renderMealSongsAsList(container, viewToggleHTML) {
            container.innerHTML = viewToggleHTML + `
                <div class="space-y-4">
                    ${mealSongs.map(song => renderMealSongCard(song)).join('')}
                </div>
            `;
        }

        function renderMealSongCard(song) {
            const titleFontSize = song.name.length > 15 ? 'text-base' : song.name.length > 10 ? 'text-lg' : 'text-xl';
            
            return `
                <div class="song-card rounded-3xl shadow-sm hover:shadow-md transition-all overflow-hidden">
                    <div class="p-4 cursor-pointer hover:bg-gray-50 transition-colors" onclick="toggleSongDetails('meal-${song.id}')">
                        <div class="flex justify-between items-center">
                            <div class="flex items-center flex-1 min-w-0">
                                <span class="text-green-600 ml-3 text-lg flex-shrink-0">ğŸ½ï¸</span>
                                <h3 class="${titleFontSize} font-bold text-gray-800 truncate">${song.name}</h3>
                            </div>
                            <div class="flex items-center space-x-2 space-x-reverse flex-shrink-0">
                                <span class="bg-blue-100 text-blue-700 px-2 py-1 rounded-full text-xs font-medium">${song.key}</span>
                                <span class="text-gray-400 text-xl" id="meal-${song.id}-arrow">â–¼</span>
                            </div>
                        </div>
                    </div>
                    <div id="meal-${song.id}-details" class="hidden border-t border-gray-200 p-4 bg-gray-50">
                        <div class="flex space-x-2 space-x-reverse mb-4">
                            <span class="bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-sm font-medium">${song.key}</span>
                            <span class="bg-green-100 text-green-700 px-3 py-1 rounded-full text-sm font-medium">${song.tempo} BPM</span>
                            ${song.transpose !== 0 ? `<span class="bg-purple-100 text-purple-700 px-3 py-1 rounded-full text-sm font-medium">${song.transpose > 0 ? '+' : ''}${song.transpose}</span>` : ''}
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <h4 class="font-semibold text-gray-700 mb-2">××§×•×¨×“×™×:</h4>
                                <p class="text-gray-600 bg-white p-3 rounded-2xl font-mono border">${song.chords}</p>
                            </div>
                            <div>
                                <h4 class="font-semibold text-gray-700 mb-2">××™×œ×™×:</h4>
                                <p class="text-gray-600 bg-white p-3 rounded-2xl whitespace-pre-line border">${song.lyrics}</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderStudents() {
            if (!isLoggedIn) return;
            
            studentsContainer.innerHTML = students.map(student => {
                const progressPercentage = (student.lessonsCompleted / student.totalLessons) * 100;
                
                return `
                    <div class="p-6 hover:bg-gray-50 transition-colors border-b border-gray-100 last:border-b-0">
                        <div class="flex flex-col lg:flex-row lg:justify-between lg:items-start gap-6">
                            <div class="flex-1">
                                <div class="flex items-center justify-between mb-4">
                                    <h3 class="text-xl font-bold text-gray-800">${student.name}</h3>
                                    <span class="px-3 py-1 rounded-full text-sm font-medium ${student.hasRecording ? 'bg-green-100 text-green-700' : 'bg-orange-100 text-orange-700'}">
                                        ${student.hasRecording ? 'ğŸ¤ ×™×© ×”×§×œ×˜×”' : 'â³ ×œ×œ× ×”×§×œ×˜×”'}
                                    </span>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                    <div class="bg-blue-50 p-3 rounded-2xl border border-blue-200">
                                        <div class="text-sm text-blue-600 font-medium mb-1">×ª××¨×™×›×™× ×—×©×•×‘×™×</div>
                                        <div class="text-blue-800">
                                            <div><span class="font-medium">×‘×¨ ××¦×•×•×”:</span> ${new Date(student.eventDate).toLocaleDateString('he-IL')}</div>
                                            <div><span class="font-medium">×©×™×¢×•×¨ ×”×‘×:</span> ${new Date(student.nextLesson).toLocaleDateString('he-IL')}</div>
                                        </div>
                                    </div>
                                    
                                    <div class="bg-purple-50 p-3 rounded-2xl border border-purple-200">
                                        <div class="text-sm text-purple-600 font-medium mb-1">×¤×¨×˜×™ ×§×¨×™××”</div>
                                        <div class="text-purple-800">
                                            <div><span class="font-medium">×¤×¨×©×”:</span> ${student.parsha}</div>
                                            <div><span class="font-medium">×¡×•×’ ×§×¨×™××”:</span> ${student.readingType}</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="bg-gradient-to-l from-amber-50 to-yellow-50 p-4 rounded-2xl border border-amber-200 mb-4">
                                    <h4 class="text-amber-800 font-semibold mb-3 flex items-center">
                                        <span class="ml-2">ğŸ“œ</span>
                                        ×¤×¨×˜×™ ×§×¨×™××” ×‘×ª×•×¨×”
                                    </h4>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm">
                                        <div>
                                            <span class="font-medium text-amber-700">×§×˜×¢ ×‘×ª×•×¨×”:</span>
                                            <div class="text-amber-800 bg-amber-100 p-2 rounded-lg mt-1">${student.torahPortion}</div>
                                        </div>
                                        <div>
                                            <span class="font-medium text-amber-700">×”×¤×˜×¨×”:</span>
                                            <div class="text-amber-800 bg-amber-100 p-2 rounded-lg mt-1">${student.haftarah}</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mb-4">
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="text-sm font-medium text-gray-700">×”×ª×§×“××•×ª ×‘×œ×™××•×“×™×</span>
                                        <span class="text-sm text-gray-600">${student.lessonsCompleted}/${student.totalLessons} ×©×™×¢×•×¨×™×</span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-3">
                                        <div class="bg-gradient-to-r from-blue-500 to-blue-600 h-3 rounded-full transition-all duration-300" style="width: ${progressPercentage}%"></div>
                                    </div>
                                    <div class="text-xs text-gray-500 mt-1">${Math.round(progressPercentage)}% ×”×•×©×œ×</div>
                                </div>
                                
                                <div class="bg-gray-50 p-4 rounded-2xl mb-4">
                                    <h4 class="font-semibold text-gray-700 mb-2">×”×ª×§×“××•×ª ×›×œ×œ×™×ª:</h4>
                                    <p class="text-gray-700 text-sm">${student.progress}</p>
                                </div>
                                
                                <div class="bg-indigo-50 p-4 rounded-2xl border border-indigo-200">
                                    <h4 class="font-semibold text-indigo-700 mb-2">×”×¢×¨×•×ª ××™×•×—×“×•×ª:</h4>
                                    <p class="text-indigo-800 text-sm">${student.specialNotes}</p>
                                </div>
                            </div>
                            
                            <div class="lg:w-80">
                                <div class="bg-white border border-gray-200 rounded-2xl p-4 shadow-sm">
                                    <h4 class="font-semibold text-gray-800 mb-3 flex items-center">
                                        <span class="ml-2">ğŸ¤</span>
                                        ××¦×‘ ×”×§×œ×˜×”
                                    </h4>
                                    
                                    <div class="space-y-3">
                                        <div class="flex items-center justify-between p-3 rounded-xl ${student.hasRecording ? 'bg-green-50 border border-green-200' : 'bg-orange-50 border border-orange-200'}">
                                            <span class="font-medium ${student.hasRecording ? 'text-green-700' : 'text-orange-700'}">
                                                ${student.hasRecording ? '×”×§×œ×˜×” ×§×™×™××ª' : '×œ×œ× ×”×§×œ×˜×”'}
                                            </span>
                                            <span class="text-2xl">${student.hasRecording ? 'âœ…' : 'âŒ'}</span>
                                        </div>
                                        
                                        <div class="bg-gray-50 p-3 rounded-xl">
                                            <div class="text-sm text-gray-600 font-medium mb-1">×”×¢×¨×•×ª ×”×§×œ×˜×”:</div>
                                            <div class="text-gray-700 text-sm">${student.recordingNotes}</div>
                                        </div>
                                        
                                        <div class="flex flex-col space-y-2">
                                            <button onclick="sendWhatsAppToStudent('${student.phone}', '${student.name}')" class="w-full bg-green-600 text-white px-4 py-2 rounded-xl hover:bg-green-700 transition-colors text-sm font-medium">
                                                ğŸ“± WhatsApp ×œ×ª×œ××™×“
                                            </button>
                                            
                                            <button onclick="toggleRecording(${student.id})" class="w-full px-4 py-2 rounded-xl text-sm font-medium transition-colors ${student.hasRecording ? 'bg-orange-600 text-white hover:bg-orange-700' : 'bg-blue-600 text-white hover:bg-blue-700'}">
                                                ${student.hasRecording ? 'ğŸ—‘ï¸ ××—×§ ×”×§×œ×˜×”' : 'ğŸ¤ ×”×•×¡×£ ×”×§×œ×˜×”'}
                                            </button>
                                            
                                            <button onclick="editStudent(${student.id})" class="w-full bg-gray-600 text-white px-4 py-2 rounded-xl hover:bg-gray-700 transition-colors text-sm font-medium">
                                                âœï¸ ×¢×¨×•×š ×¤×¨×˜×™×
                                            </button>
                                            
                                            <button onclick="viewStudentProgress(${student.id})" class="w-full bg-purple-600 text-white px-4 py-2 rounded-xl hover:bg-purple-700 transition-colors text-sm font-medium">
                                                ğŸ“Š ×™×•××Ÿ ×©×™×¢×•×¨×™×
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderEquipment() {
            const container = document.getElementById('equipmentContainer');
            const categories = [...new Set(equipment.map(item => item.category))];
            
            container.innerHTML = categories.map(category => {
                const categoryItems = equipment.filter(item => item.category === category);
                return `
                    <div class="mb-8">
                        <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                            <span class="w-3 h-3 bg-blue-500 rounded-full ml-2"></span>
                            ${category}
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                            ${categoryItems.map(item => `
                                <div class="flex items-center p-4 bg-gray-50 rounded-2xl hover:bg-gray-100 transition-colors">
                                    <input type="checkbox" id="equipment-${item.id}" ${item.checked ? 'checked' : ''} 
                                           onchange="toggleEquipment(${item.id})"
                                           class="w-5 h-5 text-blue-600 rounded-lg focus:ring-blue-500 ml-3">
                                    <label for="equipment-${item.id}" class="flex-1 font-medium text-gray-700 cursor-pointer">
                                        ${item.item}
                                    </label>
                                    <span class="text-2xl">${item.checked ? 'âœ…' : 'â­•'}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderPayments() {
            const container = document.getElementById('paymentsContainer');
            container.innerHTML = payments.map(payment => `
                <div class="bg-gray-50 p-6 rounded-3xl mb-4 hover:bg-gray-100 transition-colors">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">××™×¨×•×¢: ${payment.eventName}</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <div class="p-4 bg-white rounded-2xl">
                            <div class="flex items-center justify-between mb-3">
                                <span class="font-medium text-gray-700">×ª×©×œ×•× ×œ×§×œ×™×“×Ÿ</span>
                                <div class="flex items-center">
                                    <span class="text-2xl ml-2">${payment.keyboardistPaid ? 'âœ…' : 'âŒ'}</span>
                                    <button onclick="togglePayment(${payment.id}, 'keyboardist')" 
                                            class="px-3 py-1 rounded-full text-sm font-medium transition-colors ${payment.keyboardistPaid ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}">
                                        ${payment.keyboardistPaid ? '×©×•×œ×' : '×œ× ×©×•×œ×'}
                                    </button>
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-600">×¡×›×•×:</span>
                                <div class="flex items-center">
                                    <input type="number" value="${payment.keyboardistAmount || 0}" 
                                           onchange="updatePaymentAmount(${payment.id}, 'keyboardist', this.value)"
                                           class="w-20 px-2 py-1 border border-gray-300 rounded-lg text-sm text-center">
                                    <span class="text-sm text-gray-600 mr-1">â‚ª</span>
                                </div>
                            </div>
                        </div>
                        <div class="p-4 bg-white rounded-2xl">
                            <div class="flex items-center justify-between mb-3">
                                <span class="font-medium text-gray-700">×ª×©×œ×•× ×œ××ª×•×¤×¤×™×</span>
                                <div class="flex items-center">
                                    <span class="text-2xl ml-2">${payment.drummersPaid ? 'âœ…' : 'âŒ'}</span>
                                    <button onclick="togglePayment(${payment.id}, 'drummers')" 
                                            class="px-3 py-1 rounded-full text-sm font-medium transition-colors ${payment.drummersPaid ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}">
                                        ${payment.drummersPaid ? '×©×•×œ×' : '×œ× ×©×•×œ×'}
                                    </button>
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-600">×¡×›×•×:</span>
                                <div class="flex items-center">
                                    <input type="number" value="${payment.drummersAmount || 0}" 
                                           onchange="updatePaymentAmount(${payment.id}, 'drummers', this.value)"
                                           class="w-20 px-2 py-1 border border-gray-300 rounded-lg text-sm text-center">
                                    <span class="text-sm text-gray-600 mr-1">â‚ª</span>
                                </div>
                            </div>
                        </div>
                        <div class="p-4 bg-white rounded-2xl">
                            <div class="flex items-center justify-between mb-3">
                                <span class="font-medium text-gray-700">×ª×©×œ×•× ×œ×× ×”×œ×ª</span>
                                <div class="flex items-center">
                                    <span class="text-2xl ml-2">${payment.managerPaid ? 'âœ…' : 'âŒ'}</span>
                                    <button onclick="togglePayment(${payment.id}, 'manager')" 
                                            class="px-3 py-1 rounded-full text-sm font-medium transition-colors ${payment.managerPaid ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}">
                                        ${payment.managerPaid ? '×©×•×œ×' : '×œ× ×©×•×œ×'}
                                    </button>
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-600">×¡×›×•×:</span>
                                <div class="flex items-center">
                                    <input type="number" value="${payment.managerAmount || 0}" 
                                           onchange="updatePaymentAmount(${payment.id}, 'manager', this.value)"
                                           class="w-20 px-2 py-1 border border-gray-300 rounded-lg text-sm text-center">
                                    <span class="text-sm text-gray-600 mr-1">â‚ª</span>
                                </div>
                            </div>
                        </div>
                        <div class="flex items-center justify-between p-4 bg-white rounded-2xl">
                            <span class="font-medium text-gray-700">×§×‘×œ×” ×”×•×¦××”</span>
                            <div class="flex items-center">
                                <span class="text-2xl ml-2">${payment.receiptIssued ? 'âœ…' : 'âŒ'}</span>
                                <button onclick="togglePayment(${payment.id}, 'receipt')" 
                                        class="px-3 py-1 rounded-full text-sm font-medium transition-colors ${payment.receiptIssued ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}">
                                    ${payment.receiptIssued ? '×”×•×¦××”' : '×œ× ×”×•×¦××”'}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderSongsLibrary() {
            const libraryContainer = document.getElementById('songsLibraryContainer');
            
            const allSongs = [
                ...prayerSongs.map(song => ({...song, source: 'prayer'})),
                ...mealSongs.map(song => ({...song, source: 'meal'})),
                ...songsLibrary.filter(song => !prayerSongs.find(p => p.id === song.id) && !mealSongs.find(m => m.id === song.id))
            ];

            const searchTerm = document.getElementById('songSearch')?.value.toLowerCase() || '';
            const filteredSongs = allSongs.filter(song => 
                song.name.toLowerCase().includes(searchTerm) ||
                (song.category && song.category.toLowerCase().includes(searchTerm)) ||
                song.lyrics.toLowerCase().includes(searchTerm)
            );

            if (showCategories) {
                renderSongsWithCategories(filteredSongs, libraryContainer);
            } else {
                renderSongsAsList(filteredSongs, libraryContainer);
            }
        }

        function renderSongsWithCategories(songs, container) {
            const categories = {};
            songs.forEach(song => {
                const category = song.category || '×œ×œ× ×§×˜×’×•×¨×™×”';
                if (!categories[category]) {
                    categories[category] = [];
                }
                categories[category].push(song);
            });

            const categoryOrder = ['×›× ×™×¡×”', '×ª×¤×™×œ×”', '×”×•×¦××ª ×¡×¤×¨ ×ª×•×¨×”', '×‘×¨×›×•×ª', '×¡×¢×•×“×”', '×”×‘×“×œ×”', '×œ×œ× ×§×˜×’×•×¨×™×”'];
            
            container.innerHTML = `
                <div class="space-y-6">
                    ${categoryOrder.filter(cat => categories[cat]).map(category => `
                        <div class="bg-gray-50 rounded-3xl p-6">
                            <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                                <span class="w-4 h-4 bg-blue-500 rounded-full ml-3"></span>
                                ${category} (${categories[category].length})
                            </h3>
                            <div class="grid grid-cols-1 gap-4">
                                ${categories[category].map(song => renderSongCard(song)).join('')}
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function renderSongsAsList(songs, container) {
            container.innerHTML = `
                <div class="space-y-4">
                    <div class="flex justify-between items-center">
                        <h3 class="text-lg font-bold text-gray-800">×›×œ ×”×©×™×¨×™× (${songs.length})</h3>
                    </div>
                    
                    <div class="grid grid-cols-1 gap-4">
                        ${songs.map(song => renderSongCard(song)).join('')}
                    </div>
                </div>
            `;
        }

        function renderSongCard(song) {
            return `
                <div class="song-card p-4 rounded-2xl shadow-sm hover:shadow-md transition-all bg-white">
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <h4 class="text-lg font-bold text-gray-800">${song.name}</h4>
                            <div class="flex items-center space-x-2 space-x-reverse mt-1">
                                ${song.category ? `<span class="bg-purple-100 text-purple-700 px-2 py-1 rounded-full text-xs font-medium">${song.category}</span>` : ''}
                                <span class="bg-blue-100 text-blue-700 px-2 py-1 rounded-full text-xs font-medium">${song.key}</span>
                                <span class="bg-green-100 text-green-700 px-2 py-1 rounded-full text-xs font-medium">${song.tempo} BPM</span>
                                ${song.transpose !== 0 ? `<span class="bg-orange-100 text-orange-700 px-2 py-1 rounded-full text-xs font-medium">${song.transpose > 0 ? '+' : ''}${song.transpose}</span>` : ''}
                            </div>
                        </div>
                        <div class="flex space-x-2 space-x-reverse">
                            ${song.youtubeLink ? `
                                <button onclick="window.open('${song.youtubeLink}', '_blank')" class="bg-red-600 text-white px-3 py-1 rounded-xl text-sm hover:bg-red-700">
                                    ğŸ“º YouTube
                                </button>
                            ` : ''}
                            <button onclick="editSong(${song.id})" class="bg-blue-600 text-white px-3 py-1 rounded-xl text-sm hover:bg-blue-700">
                                âœï¸ ×¢×¨×•×š
                            </button>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm">
                        <div>
                            <span class="font-medium text-gray-700">××§×•×¨×“×™×:</span>
                            <div class="bg-gray-100 p-2 rounded-lg font-mono mt-1">${song.chords}</div>
                        </div>
                        <div>
                            <span class="font-medium text-gray-700">××™×œ×™×:</span>
                            <div class="bg-gray-100 p-2 rounded-lg mt-1 max-h-20 overflow-y-auto whitespace-pre-line">${song.lyrics}</div>
                        </div>
                    </div>
                </div>
            `;
        }

        function toggleCategories() {
            showCategories = !showCategories;
            const btn = document.getElementById('toggleCategoriesBtn');
            
            if (showCategories) {
                btn.textContent = 'ğŸ“‹ ×”×¦×’ ×¨×©×™××”';
                btn.className = btn.className.replace('bg-purple-600', 'bg-orange-600').replace('hover:bg-purple-700', 'hover:bg-orange-700');
            } else {
                btn.textContent = 'ğŸ“‚ ×”×¦×’ ×§×˜×’×•×¨×™×•×ª';
                btn.className = btn.className.replace('bg-orange-600', 'bg-purple-600').replace('hover:bg-orange-700', 'hover:bg-purple-700');
            }
            
            renderSongsLibrary();
        }

        function togglePrayerView(view) {
            showPrayerCategories = (view === 'categories');
            renderPrayerSongs();
        }

        function toggleMealView(view) {
            showMealCategories = (view === 'categories');
            renderMealSongs();
        }

        async function toggleEquipment(id) {
            const item = equipment.find(e => e.id === id);
            if (item) {
                item.checked = !item.checked;
                renderEquipment();
                await saveDataToCMS();
            }
        }

        async function togglePayment(id, type) {
            const payment = payments.find(p => p.id === id);
            if (payment) {
                switch(type) {
                    case 'keyboardist':
                        payment.keyboardistPaid = !payment.keyboardistPaid;
                        break;
                    case 'drummers':
                        payment.drummersPaid = !payment.drummersPaid;
                        break;
                    case 'manager':
                        payment.managerPaid = !payment.managerPaid;
                        break;
                    case 'receipt':
                        payment.receiptIssued = !payment.receiptIssued;
                        break;
                }
                renderPayments();
                await saveDataToCMS();
            }
        }

        function toggleRecording(studentId) {
            const student = students.find(s => s.id === studentId);
            if (student) {
                student.hasRecording = !student.hasRecording;
                if (student.hasRecording) {
                    student.recordingNotes = "×”×§×œ×˜×” ×—×“×©×” × ×•×¡×¤×”";
                } else {
                    student.recordingNotes = "×”×§×œ×˜×” ×”×•×¡×¨×”";
                }
                renderStudents();
            }
        }

        function editStudent(studentId) {
            alert(`×¢×¨×™×›×ª ×ª×œ××™×“ ${studentId} - ×¤×•× ×§×¦×™×” ×–×• ×ª×¤×•×ª×— ×‘×”××©×š`);
        }

        function viewStudentProgress(studentId) {
            const student = students.find(s => s.id === studentId);
            if (student) {
                alert(`×™×•××Ÿ ×©×™×¢×•×¨×™× ×©×œ ${student.name}:\n\n×”×•×©×œ××•: ${student.lessonsCompleted}/${student.totalLessons} ×©×™×¢×•×¨×™×\n×”×ª×§×“××•×ª: ${student.progress}`);
            }
        }

        function editSong(songId) {
            alert(`×¢×¨×™×›×ª ×©×™×¨ ${songId} - ×¤×•× ×§×¦×™×” ×–×• ×ª×¤×•×ª×— ×‘×”××©×š`);
        }

        function toggleSongDetails(songId) {
            const details = document.getElementById(`${songId}-details`);
            const arrow = document.getElementById(`${songId}-arrow`);
            
            if (details.classList.contains('hidden')) {
                details.classList.remove('hidden');
                arrow.textContent = 'â–²';
            } else {
                details.classList.add('hidden');
                arrow.textContent = 'â–¼';
            }
        }

        function editMediaLinks(eventId) {
            const event = events.find(e => e.id === eventId);
            if (!event) return;
            
            const photosLink = prompt('×§×™×©×•×¨ ×œ×ª××•× ×•×ª:', event.mediaLinks?.photos || '');
            if (photosLink === null) return;
            
            const videosLink = prompt('×§×™×©×•×¨ ×œ×¡×¨×˜×•× ×™×:', event.mediaLinks?.videos || '');
            if (videosLink === null) return;
            
            if (!event.mediaLinks) {
                event.mediaLinks = {};
            }
            
            event.mediaLinks.photos = photosLink;
            event.mediaLinks.videos = videosLink;
            
            openEventModal(eventId);
            saveDataToCMS();
            showNotification('×§×™×©×•×¨×™ ××“×™×” ×¢×•×“×›× ×• ×‘×”×¦×œ×—×”!', 'success');
        }

        function manageCategories() {
            let categoriesHTML = `
                <div class="space-y-4">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">× ×™×”×•×œ ×§×˜×’×•×¨×™×•×ª ×©×™×¨×™×</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        ${songCategories.map(category => `
                            <div class="bg-${category.color}-50 border border-${category.color}-200 p-4 rounded-2xl">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center">
                                        <span class="text-2xl ml-3">${category.icon}</span>
                                        <span class="font-medium text-${category.color}-800">${category.name}</span>
                                    </div>
                                    <div class="flex space-x-2 space-x-reverse">
                                        <button onclick="editCategory(${category.id})" class="bg-blue-600 text-white px-2 py-1 rounded-lg text-xs hover:bg-blue-700">
                                            âœï¸
                                        </button>
                                        <button onclick="deleteCategory(${category.id})" class="bg-red-600 text-white px-2 py-1 rounded-lg text-xs hover:bg-red-700">
                                            ğŸ—‘ï¸
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <button onclick="addNewCategory()" class="w-full bg-green-600 text-white px-4 py-3 rounded-2xl hover:bg-green-700 transition-colors font-medium">
                        â• ×”×•×¡×£ ×§×˜×’×•×¨×™×” ×—×“×©×”
                    </button>
                </div>
            `;
            
            modalTitle.textContent = '× ×™×”×•×œ ×§×˜×’×•×¨×™×•×ª';
            modalContent.innerHTML = categoriesHTML;
            eventModal.classList.remove('hidden');
        }

        function editCategory(categoryId) {
            const category = songCategories.find(c => c.id === categoryId);
            if (!category) return;
            
            const newName = prompt('×©× ×”×§×˜×’×•×¨×™×”:', category.name);
            if (newName && newName !== category.name) {
                category.name = newName;
                manageCategories();
                renderSongsLibrary();
                showNotification('×§×˜×’×•×¨×™×” ×¢×•×“×›× ×” ×‘×”×¦×œ×—×”!', 'success');
            }
        }

        function deleteCategory(categoryId) {
            const category = songCategories.find(c => c.id === categoryId);
            if (!category) return;
            
            if (confirm(`×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××ª ×”×§×˜×’×•×¨×™×” "${category.name}"?`)) {
                const index = songCategories.findIndex(c => c.id === categoryId);
                songCategories.splice(index, 1);
                
                // Update songs that had this category
                songsLibrary.forEach(song => {
                    if (song.category === category.name) {
                        song.category = '×›×œ×œ×™';
                    }
                });
                
                manageCategories();
                renderSongsLibrary();
                showNotification('×§×˜×’×•×¨×™×” × ××—×§×” ×‘×”×¦×œ×—×”!', 'success');
            }
        }

        function addNewCategory() {
            const name = prompt('×©× ×”×§×˜×’×•×¨×™×” ×”×—×“×©×”:');
            if (!name) return;
            
            const icon = prompt('××™×™×§×•×Ÿ ×œ×§×˜×’×•×¨×™×” (×××•×’\'×™):', 'ğŸµ');
            if (!icon) return;
            
            const colors = ['blue', 'purple', 'green', 'orange', 'pink', 'indigo', 'teal', 'amber', 'red'];
            const color = colors[Math.floor(Math.random() * colors.length)];
            
            const newCategory = {
                id: Math.max(...songCategories.map(c => c.id)) + 1,
                name: name,
                color: color,
                icon: icon
            };
            
            songCategories.push(newCategory);
            manageCategories();
            showNotification('×§×˜×’×•×¨×™×” ×—×“×©×” × ×•×¡×¤×” ×‘×”×¦×œ×—×”!', 'success');
        }

        function addNewEvent() {
            const name = prompt('×©× ×‘×¨ ×”××¦×•×•×”:');
            if (!name) return;
            
            const date = prompt('×ª××¨×™×š (YYYY-MM-DD):');
            if (!date) return;
            
            const time = prompt('×©×¢×” (HH:MM):');
            if (!time) return;
            
            const location = prompt('××™×§×•×:');
            if (!location) return;
            
            const newEvent = {
                id: Math.max(...events.map(e => e.id)) + 1,
                name: name,
                date: date,
                time: time,
                guestArrivalTime: time,
                eventStartTime: time,
                location: location,
                wazeLink: `https://waze.com/ul?q=${encodeURIComponent(location)}`,
                package: "×—×‘×™×œ×” ×‘×¡×™×¡×™×ª",
                keyboardist: false,
                drummers: 0,
                isStudent: false,
                price: 2000,
                parentPhone: "",
                parentName: "",
                notes: "",
                status: "pending",
                mediaLinks: { photos: "", videos: "" }
            };
            
            events.push(newEvent);
            filteredEvents = [...events];
            renderEvents();
            alert('××™×¨×•×¢ ×—×“×© × ×•×¡×£ ×‘×”×¦×œ×—×”!');
        }

        function addNewSong() {
            const name = prompt('×©× ×”×©×™×¨:');
            if (!name) return;
            
            const key = prompt('×¡×•×œ×:');
            if (!key) return;
            
            const newSong = {
                id: Math.max(...songsLibrary.map(s => s.id)) + 1,
                name: name,
                key: key,
                tempo: 120,
                transpose: 0,
                chords: "C - Am - F - G",
                lyrics: "××™×œ×•×ª ×”×©×™×¨...",
                category: "×›×œ×œ×™"
            };
            
            songsLibrary.push(newSong);
            renderSongsLibrary();
            alert('×©×™×¨ ×—×“×© × ×•×¡×£ ×‘×”×¦×œ×—×”!');
        }

        function renderImportantLinks() {
            const container = document.getElementById('importantLinksContainer');
            
            // Group links by category
            const categories = {};
            importantLinks.forEach(link => {
                const category = link.category || '×›×œ×œ×™';
                if (!categories[category]) {
                    categories[category] = [];
                }
                categories[category].push(link);
            });

            const categoryColors = {
                '×›×¡×¤×™×': 'bg-green-50 border-green-200 text-green-800',
                '× ×™×”×•×œ ×–××Ÿ': 'bg-blue-50 border-blue-200 text-blue-800',
                '×ª×§×©×•×¨×ª': 'bg-purple-50 border-purple-200 text-purple-800',
                '×›×œ×œ×™': 'bg-gray-50 border-gray-200 text-gray-800'
            };

            container.innerHTML = `
                <div class="space-y-6">
                    ${Object.keys(categories).map(category => `
                        <div class="${categoryColors[category] || categoryColors['×›×œ×œ×™']} rounded-3xl p-6 border">
                            <h3 class="text-xl font-bold mb-4 flex items-center">
                                <span class="w-4 h-4 bg-current rounded-full ml-3 opacity-60"></span>
                                ${category} (${categories[category].length})
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                ${categories[category].map(link => `
                                    <div class="bg-white p-4 rounded-2xl shadow-sm hover:shadow-md transition-all border border-gray-100">
                                        <div class="flex items-start justify-between mb-3">
                                            <div class="flex items-center">
                                                <span class="text-2xl ml-3">${link.icon}</span>
                                                <h4 class="font-bold text-gray-800 text-sm">${link.name}</h4>
                                            </div>
                                            <div class="flex space-x-1 space-x-reverse">
                                                <button onclick="editLink(${link.id})" class="bg-blue-600 text-white px-2 py-1 rounded-lg text-xs hover:bg-blue-700 transition-colors">
                                                    âœï¸
                                                </button>
                                                <button onclick="deleteLink(${link.id})" class="bg-red-600 text-white px-2 py-1 rounded-lg text-xs hover:bg-red-700 transition-colors">
                                                    ğŸ—‘ï¸
                                                </button>
                                            </div>
                                        </div>
                                        <p class="text-gray-600 text-xs mb-3">${link.description}</p>
                                        <button onclick="window.open('${link.url}', '_blank')" 
                                                class="w-full bg-cyan-600 text-white px-4 py-2 rounded-xl hover:bg-cyan-700 transition-colors font-medium text-sm flex items-center justify-center">
                                            <span class="ml-2">ğŸ”—</span>
                                            <span>×¤×ª×— ×§×™×©×•×¨</span>
                                        </button>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function addNewLink() {
            const name = prompt('×©× ×”×§×™×©×•×¨:');
            if (!name) return;
            
            const url = prompt('×›×ª×•×‘×ª ×”×§×™×©×•×¨ (URL):');
            if (!url) return;
            
            const description = prompt('×ª×™××•×¨ ×”×§×™×©×•×¨:') || '';
            const category = prompt('×§×˜×’×•×¨×™×” (×›×¡×¤×™×/× ×™×”×•×œ ×–××Ÿ/×ª×§×©×•×¨×ª/×›×œ×œ×™):') || '×›×œ×œ×™';
            const icon = prompt('××™×™×§×•×Ÿ (×××•×’\'×™):') || 'ğŸ”—';
            
            const newLink = {
                id: Math.max(...importantLinks.map(l => l.id)) + 1,
                name: name,
                url: url,
                description: description,
                category: category,
                icon: icon
            };
            
            importantLinks.push(newLink);
            renderImportantLinks();
            saveDataToCMS();
            showNotification('×§×™×©×•×¨ ×—×“×© × ×•×¡×£ ×‘×”×¦×œ×—×”!', 'success');
        }

        function editLink(linkId) {
            const link = importantLinks.find(l => l.id === linkId);
            if (!link) return;
            
            const newName = prompt('×©× ×”×§×™×©×•×¨:', link.name);
            if (newName === null) return;
            
            const newUrl = prompt('×›×ª×•×‘×ª ×”×§×™×©×•×¨:', link.url);
            if (newUrl === null) return;
            
            const newDescription = prompt('×ª×™××•×¨ ×”×§×™×©×•×¨:', link.description);
            if (newDescription === null) return;
            
            const newCategory = prompt('×§×˜×’×•×¨×™×”:', link.category);
            if (newCategory === null) return;
            
            const newIcon = prompt('××™×™×§×•×Ÿ:', link.icon);
            if (newIcon === null) return;
            
            link.name = newName;
            link.url = newUrl;
            link.description = newDescription;
            link.category = newCategory;
            link.icon = newIcon;
            
            renderImportantLinks();
            saveDataToCMS();
            showNotification('×§×™×©×•×¨ ×¢×•×“×›×Ÿ ×‘×”×¦×œ×—×”!', 'success');
        }

        function deleteLink(linkId) {
            const link = importantLinks.find(l => l.id === linkId);
            if (!link) return;
            
            if (confirm(`×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××ª ×”×§×™×©×•×¨ "${link.name}"?`)) {
                const index = importantLinks.findIndex(l => l.id === linkId);
                importantLinks.splice(index, 1);
                
                renderImportantLinks();
                saveDataToCMS();
                showNotification('×§×™×©×•×¨ × ××—×§ ×‘×”×¦×œ×—×”!', 'success');
            }
        }

        function updatePaymentAmount(paymentId, type, amount) {
            const payment = payments.find(p => p.id === paymentId);
            if (payment) {
                const numAmount = parseInt(amount) || 0;
                switch(type) {
                    case 'keyboardist':
                        payment.keyboardistAmount = numAmount;
                        break;
                    case 'drummers':
                        payment.drummersAmount = numAmount;
                        break;
                    case 'manager':
                        payment.managerAmount = numAmount;
                        break;
                }
                saveDataToCMS();
            }
        }

        function openEventModal(eventId) {
            const event = events.find(e => e.id === eventId);
            if (!event) return;

            modalTitle.textContent = `×‘×¨ ××¦×•×•×” - ${event.name}`;
            
            const packageColors = {
                '×—×‘×™×œ×” ×‘×¡×™×¡×™×ª': 'bg-blue-50 text-blue-700 border-blue-200',
                '×—×‘×™×œ×” ×—×’×™×’×™×ª': 'bg-purple-50 text-purple-700 border-purple-200',
                '×—×‘×™×œ×ª ×”×›×œ ×›×œ×•×œ': 'bg-amber-50 text-amber-700 border-amber-200'
            };

            const musicians = [];
            if (event.keyboardist) musicians.push('×§×œ×™×“×Ÿ');
            if (event.drummers > 0) musicians.push(`${event.drummers} ××ª×•×¤×¤×™×`);
            const musicianText = musicians.length > 0 ? musicians.join(' + ') : '×œ×œ× ×œ×™×•×•×™ ××•×–×™×§×œ×™';

            let modalHTML = `
                <div class="space-y-4 sm:space-y-6">
                    <div class="bg-gradient-to-l from-blue-50 to-indigo-50 p-4 sm:p-6 rounded-2xl sm:rounded-3xl border border-blue-100">
                        <h4 class="text-base sm:text-lg font-semibold text-gray-800 mb-3 sm:mb-4">×¤×¨×˜×™ ×”××™×¨×•×¢</h4>
                        <div class="space-y-3 sm:space-y-0 sm:grid sm:grid-cols-1 md:grid-cols-3 sm:gap-4">
                            <div class="bg-blue-100 p-3 rounded-xl border border-blue-200 cursor-pointer hover:bg-blue-200 transition-colors" onclick="addToGoogleCalendar(${event.id})">
                                <div class="flex items-center">
                                    <span class="text-blue-600 ml-2 text-lg">ğŸ“…</span>
                                    <div>
                                        <span class="font-medium text-blue-800 text-sm">×ª××¨×™×š:</span>
                                        <div class="text-blue-700 font-bold text-sm">${new Date(event.date).toLocaleDateString('he-IL', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' })}</div>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-green-100 p-3 rounded-xl border border-green-200">
                                <div class="flex items-center">
                                    <span class="text-green-600 ml-2 text-lg">ğŸ‘¥</span>
                                    <div>
                                        <span class="font-medium text-green-800 text-sm">×”×’×¢×ª ××•×¨×—×™×:</span>
                                        <div class="text-green-700 font-bold text-sm">${event.guestArrivalTime || event.time}</div>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-orange-100 p-3 rounded-xl border border-orange-200">
                                <div class="flex items-center">
                                    <span class="text-orange-600 ml-2 text-lg">ğŸ‰</span>
                                    <div>
                                        <span class="font-medium text-orange-800 text-sm">×ª×—×™×œ×ª ××™×¨×•×¢:</span>
                                        <div class="text-orange-700 font-bold text-sm">${event.eventStartTime || event.time}</div>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-purple-100 p-3 rounded-xl border border-purple-200 md:col-span-3 cursor-pointer hover:bg-purple-200 transition-colors" onclick="openWaze('${event.wazeLink}')">
                                <div class="flex items-center">
                                    <span class="text-purple-600 ml-2 text-lg">ğŸ“</span>
                                    <div class="flex-1">
                                        <span class="font-medium text-purple-800 text-sm">××™×§×•×:</span>
                                        <div class="flex items-center justify-between">
                                            <div class="text-purple-700 font-bold text-sm flex-1">${event.location}</div>
                                            ${isLoggedIn ? `
                                                <button onclick="event.stopPropagation(); editWazeLink(${event.id})" 
                                                        class="bg-orange-600 text-white px-2 py-1 rounded-lg text-xs hover:bg-orange-700 transition-colors">
                                                    âš™ï¸
                                                </button>
                                            ` : ''}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 gap-4 sm:gap-6">
                        <div>
                            <h4 class="text-base sm:text-lg font-semibold text-gray-800 mb-2 sm:mb-3">×—×‘×™×œ×ª ×”×©×™×¨×•×ª</h4>
                            <div class="inline-block px-3 sm:px-4 py-2 sm:py-3 rounded-xl sm:rounded-2xl border ${packageColors[event.package]} font-medium text-sm sm:text-base">
                                ${event.package}
                            </div>
                        </div>
                        
                        <div>
                            <h4 class="text-base sm:text-lg font-semibold text-gray-800 mb-2 sm:mb-3">×œ×™×•×•×™ ××•×–×™×§×œ×™</h4>
                            <div class="bg-gray-50 p-3 sm:p-4 rounded-xl sm:rounded-2xl">
                                <div class="flex items-center">
                                    <span class="text-orange-500 ml-2">ğŸµ</span>
                                    <span class="text-gray-700 text-sm sm:text-base">${musicianText}</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="border-t border-gray-200 pt-4 sm:pt-6">
                        <div class="flex justify-between items-center mb-2 sm:mb-3">
                            <h4 class="text-base sm:text-lg font-semibold text-gray-800">×ª××•× ×•×ª ×•×¡×¨×˜×•× ×™× ××”××™×¨×•×¢</h4>
                            ${isLoggedIn ? `
                                <button onclick="editMediaLinks(${event.id})" class="bg-blue-600 text-white px-3 py-1 rounded-lg text-sm hover:bg-blue-700 transition-colors">
                                    âœï¸ ×¢×¨×•×š ×§×™×©×•×¨×™×
                                </button>
                            ` : ''}
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                            <div class="bg-pink-50 p-3 sm:p-4 rounded-xl sm:rounded-2xl border border-pink-200 hover:bg-pink-100 transition-colors flex items-center ${event.mediaLinks?.photos ? 'cursor-pointer' : ''}" ${event.mediaLinks?.photos ? `onclick="window.open('${event.mediaLinks.photos}', '_blank')"` : ''}>
                                <span class="text-pink-600 ml-2 text-lg">ğŸ“¸</span>
                                <div>
                                    <div class="font-medium text-pink-800">×ª××•× ×•×ª ××”××™×¨×•×¢</div>
                                    <div class="text-xs text-pink-600">${event.mediaLinks?.photos ? '×œ×—×¥ ×œ×¦×¤×™×™×”' : '××™×Ÿ ×§×™×©×•×¨'}</div>
                                </div>
                            </div>
                            <div class="bg-indigo-50 p-3 sm:p-4 rounded-xl sm:rounded-2xl border border-indigo-200 hover:bg-indigo-100 transition-colors flex items-center ${event.mediaLinks?.videos ? 'cursor-pointer' : ''}" ${event.mediaLinks?.videos ? `onclick="window.open('${event.mediaLinks.videos}', '_blank')"` : ''}>
                                <span class="text-indigo-600 ml-2 text-lg">ğŸ¥</span>
                                <div>
                                    <div class="font-medium text-indigo-800">×¡×¨×˜×•× ×™× ××”××™×¨×•×¢</div>
                                    <div class="text-xs text-indigo-600">${event.mediaLinks?.videos ? '×œ×—×¥ ×œ×¦×¤×™×™×”' : '××™×Ÿ ×§×™×©×•×¨'}</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    ${isLoggedIn ? `
                        <div class="border-t border-gray-200 pt-4 sm:pt-6">
                            <div class="grid grid-cols-1 gap-4 sm:gap-6">
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    <div>
                                        <h4 class="text-base sm:text-lg font-semibold text-gray-800 mb-2 sm:mb-3">×¤×¨×˜×™× ×¤×™× × ×¡×™×™×</h4>
                                        <div class="bg-green-50 p-3 sm:p-4 rounded-xl sm:rounded-2xl border border-green-200">
                                            <div class="text-xl sm:text-2xl font-bold text-green-600">â‚ª${event.price.toLocaleString()}</div>
                                            <div class="text-xs sm:text-sm text-gray-600">××—×™×¨ ×¡×•×¤×™</div>
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <h4 class="text-base sm:text-lg font-semibold text-gray-800 mb-2 sm:mb-3">×¤×¨×˜×™ ×§×©×¨</h4>
                                        <div class="bg-gray-50 p-3 sm:p-4 rounded-xl sm:rounded-2xl space-y-2">
                                            <div class="text-sm"><span class="font-medium">×”×•×¨×”:</span> ${event.parentName}</div>
                                            <div class="text-sm"><span class="font-medium">×˜×œ×¤×•×Ÿ:</span> ${event.parentPhone}</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div>
                                    <h4 class="text-base sm:text-lg font-semibold text-gray-800 mb-2 sm:mb-3">×”×¢×¨×•×ª</h4>
                                    <div class="bg-yellow-50 p-3 sm:p-4 rounded-xl sm:rounded-2xl border border-yellow-200">
                                        <p class="text-gray-700 text-sm sm:text-base">${event.notes}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    ` : ''}
                </div>
                
                <div class="flex flex-col sm:flex-row justify-end space-y-2 sm:space-y-0 sm:space-x-3 sm:space-x-reverse mt-6 sm:mt-8 pt-4 sm:pt-6 border-t border-gray-200">
                    <button class="px-4 sm:px-6 py-2 bg-gray-200 text-gray-700 rounded-xl sm:rounded-2xl hover:bg-gray-300 transition-colors font-medium text-sm sm:text-base" onclick="document.getElementById('eventModal').classList.add('hidden')">
                        ×¡×’×•×¨
                    </button>
                    ${isLoggedIn ? `
                        <button onclick="openYeshInvoice()" class="px-4 sm:px-6 py-2 bg-blue-600 text-white rounded-xl sm:rounded-2xl hover:bg-blue-700 transition-colors font-medium text-sm sm:text-base flex items-center justify-center">
                            <span class="ml-2">ğŸ§¾</span>
                            <span>×™×© ×—×©×‘×•× ×™×ª</span>
                        </button>
                        <button onclick="sendWhatsAppToParent('${event.parentPhone}', '${event.parentName}', '${event.name}')" class="px-4 sm:px-6 py-2 bg-green-600 text-white rounded-xl sm:rounded-2xl hover:bg-green-700 transition-colors font-medium text-sm sm:text-base flex items-center justify-center">
                            <span class="ml-2">ğŸ“±</span>
                            <span>×©×œ×— WhatsApp</span>
                        </button>
                    ` : ''}
                </div>
            `;

            modalContent.innerHTML = modalHTML;
            eventModal.classList.remove('hidden');
        }

        function openWaze(wazeLink) {
            if (wazeLink) {
                window.open(wazeLink, '_blank');
            } else {
                alert('×§×™×©×•×¨ Waze ×œ× ×–××™×Ÿ ×œ××™×¨×•×¢ ×–×”');
            }
        }

        function addToGoogleCalendar(eventId) {
            const event = events.find(e => e.id === eventId);
            if (!event) return;

            const eventDate = new Date(event.date);
            const [hours, minutes] = event.eventStartTime.split(':');
            eventDate.setHours(parseInt(hours), parseInt(minutes));
            
            const endDate = new Date(eventDate);
            endDate.setHours(endDate.getHours() + 3);

            const startTime = eventDate.toISOString().replace(/[-:]/g, '').replace(/\.\d{3}/, '');
            const endTime = endDate.toISOString().replace(/[-:]/g, '').replace(/\.\d{3}/, '');

            const title = `×‘×¨ ××¦×•×•×” - ${event.name}`;
            const details = `
×‘×¨ ××¦×•×•×”: ${event.name}
×—×‘×™×œ×”: ${event.package}
××™×§×•×: ${event.location}

â° ×–×× ×™×:
ğŸ‘¥ ×”×’×¢×ª ××•×¨×—×™×: ${event.guestArrivalTime}
ğŸ‰ ×ª×—×™×œ×ª ××™×¨×•×¢: ${event.eventStartTime}

${event.keyboardist ? 'ğŸ¹ ×¢× ×§×œ×™×“×Ÿ' : ''}
${event.drummers > 0 ? `ğŸ¥ ${event.drummers} ××ª×•×¤×¤×™×` : ''}
${event.notes ? `\n×”×¢×¨×•×ª: ${event.notes}` : ''}
${isLoggedIn ? `\n×”×•×¨×”: ${event.parentName}\n×˜×œ×¤×•×Ÿ: ${event.parentPhone}\n××—×™×¨: â‚ª${event.price.toLocaleString()}` : ''}
            `.trim();

            const googleCalendarUrl = `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(title)}&dates=${startTime}/${endTime}&details=${encodeURIComponent(details)}&location=${encodeURIComponent(event.location)}&sf=true&output=xml`;

            window.open(googleCalendarUrl, '_blank');
        }

        function editWazeLink(eventId) {
            const event = events.find(e => e.id === eventId);
            if (event) {
                const newLink = prompt('×”×›× ×¡ ×§×™×©×•×¨ Waze ×—×“×©:', event.wazeLink);
                if (newLink !== null) {
                    event.wazeLink = newLink;
                    openEventModal(eventId);
                    alert('×§×™×©×•×¨ Waze ×¢×•×“×›×Ÿ ×‘×”×¦×œ×—×”!');
                }
            }
        }

        function sendWhatsAppToParent(phone, parentName, studentName) {
            const message = `×©×œ×•× ${parentName},\n\n×‘×§×©×¨ ×œ×‘×¨ ×”××¦×•×•×” ×©×œ ${studentName}.\n\n××©××— ×œ×ª×× ×¤×¨×˜×™× × ×•×¡×¤×™×.\n\n×‘×‘×¨×›×”,\n×”×× ×”×œ`;
            const cleanPhone = phone.replace(/[^0-9]/g, '');
            const whatsappUrl = `https://wa.me/${cleanPhone}?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
        }

        function sendWhatsAppToStudent(phone, studentName) {
            const message = `×©×œ×•× ${studentName},\n\n×ª×–×›×•×¨×ª ×œ×©×™×¢×•×¨ ×”×§×¨×•×‘.\n\n× ×ª×¨××”!`;
            const cleanPhone = phone.replace(/[^0-9]/g, '');
            const whatsappUrl = `https://wa.me/${cleanPhone}?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
        }

        async function saveDataToCMS() {
            try {
                systemData.events = events;
                systemData.students = students;
                systemData.prayerSongs = prayerSongs;
                systemData.mealSongs = mealSongs;
                systemData.equipment = equipment;
                systemData.payments = payments;
                systemData.lessons = lessons;
                systemData.messageHistory = messageHistory;
                systemData.songsLibrary = songsLibrary;
                systemData.songCategories = songCategories;
                systemData.importantLinks = importantLinks;
                systemData.lastUpdated = new Date().toISOString();
                
                localStorage.setItem('barMitzvahData', JSON.stringify(systemData));
                
                console.log('× ×ª×•× ×™× × ×©××¨×• ×‘×”×¦×œ×—×”');
                return true;
            } catch (error) {
                console.error('×©×’×™××” ×‘×©××™×¨×ª × ×ª×•× ×™×:', error);
                return false;
            }
        }

        async function refreshDataFromCMS() {
            try {
                const savedData = localStorage.getItem('barMitzvahData');
                if (savedData) {
                    const parsedData = JSON.parse(savedData);
                    
                    events.length = 0;
                    events.push(...parsedData.events);
                    
                    students.length = 0;
                    students.push(...parsedData.students);
                    
                    prayerSongs.length = 0;
                    prayerSongs.push(...parsedData.prayerSongs);
                    
                    mealSongs.length = 0;
                    mealSongs.push(...parsedData.mealSongs);
                    
                    equipment.length = 0;
                    equipment.push(...parsedData.equipment);
                    
                    payments.length = 0;
                    payments.push(...parsedData.payments);
                    
                    if (parsedData.songCategories) {
                        songCategories.length = 0;
                        songCategories.push(...parsedData.songCategories);
                    }
                    
                    if (parsedData.importantLinks) {
                        importantLinks.length = 0;
                        importantLinks.push(...parsedData.importantLinks);
                    }
                    
                    filteredEvents = [...events];
                    renderCurrentPage();
                    
                    showNotification('× ×ª×•× ×™× ×¨×•×¢× ×• ×‘×”×¦×œ×—×”!', 'success');
                } else {
                    showNotification('×œ× × ××¦××• × ×ª×•× ×™× ×©××•×¨×™×', 'info');
                }
            } catch (error) {
                console.error('×©×’×™××” ×‘×¨×¢× ×•×Ÿ × ×ª×•× ×™×:', error);
                showNotification('×©×’×™××” ×‘×¨×¢× ×•×Ÿ × ×ª×•× ×™×', 'error');
            }
        }

        function exportToCMSFormat() {
            const dataToExport = {
                events: events,
                students: students,
                prayerSongs: prayerSongs,
                mealSongs: mealSongs,
                equipment: equipment,
                payments: payments,
                lessons: lessons,
                messageHistory: messageHistory,
                songsLibrary: songsLibrary,
                songCategories: songCategories,
                importantLinks: importantLinks,
                exportDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(dataToExport, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `bar-mitzvah-data-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            showNotification('× ×ª×•× ×™× ×™×•×¦××• ×‘×”×¦×œ×—×”!', 'success');
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 p-4 rounded-2xl shadow-lg max-w-sm transition-all duration-300 ${
                type === 'success' ? 'bg-green-100 text-green-800 border border-green-200' :
                type === 'error' ? 'bg-red-100 text-red-800 border border-red-200' :
                'bg-blue-100 text-blue-800 border border-blue-200'
            }`;
            
            notification.innerHTML = `
                <div class="flex items-center">
                    <span class="ml-2">${type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : 'â„¹ï¸'}</span>
                    <span class="font-medium">${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // PWA functionality
        let deferredPrompt;
        const installButton = document.getElementById('installApp');

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installButton.classList.remove('hidden');
        });

        installButton.addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') {
                    showNotification('×”××¤×œ×™×§×¦×™×” ×”×•×ª×§× ×” ×‘×”×¦×œ×—×”!', 'success');
                }
                deferredPrompt = null;
                installButton.classList.add('hidden');
            }
        });

        // Generate PWA manifest dynamically
        const manifest = {
            name: "××¢×¨×›×ª × ×™×”×•×œ ××™×¨×•×¢×™ ×‘×¨ ××¦×•×•×”",
            short_name: "×‘×¨ ××¦×•×•×” ×× ×”×œ",
            description: "××¢×¨×›×ª × ×™×”×•×œ ××§×¦×•×¢×™×ª ×œ××™×¨×•×¢×™ ×‘×¨ ××¦×•×•×”",
            start_url: "/",
            display: "standalone",
            background_color: "#1e3a8a",
            theme_color: "#1e3a8a",
            icons: [
                {
                    src: "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%231e3a8a'/><text y='50' x='50' text-anchor='middle' dominant-baseline='middle' font-size='40' fill='white'>ğŸµ</text></svg>",
                    sizes: "192x192",
                    type: "image/svg+xml"
                },
                {
                    src: "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%231e3a8a'/><text y='50' x='50' text-anchor='middle' dominant-baseline='middle' font-size='40' fill='white'>ğŸµ</text></svg>",
                    sizes: "512x512",
                    type: "image/svg+xml"
                }
            ]
        };

        document.getElementById('manifest').href = 'data:application/json;charset=utf-8,' + encodeURIComponent(JSON.stringify(manifest));

        // Check for Auth0 callback on page load
        async function handleAuth0Callback() {
            try {
                if (auth0Client && window.location.search.includes('code=')) {
                    console.log('××¢×‘×“ callback ×©×œ Auth0...');
                    
                    const result = await auth0Client.handleRedirectCallback();
                    
                    window.history.replaceState({}, document.title, window.location.pathname);
                    
                    const user = await auth0Client.getUser();
                    
                    if (user) {
                        console.log('×”×ª×—×‘×¨×•×ª Auth0 ×”×¦×œ×™×—×”:', user);
                        login();
                        currentAuthProvider = 'auth0';
                        showNotification(`×‘×¨×•×š ×”×‘× ${user.name || user.email}!`, 'success');
                    }
                }
            } catch (error) {
                console.error('Auth0 callback error:', error);
                showNotification('×©×’×™××” ×‘×”×ª×—×‘×¨×•×ª', 'error');
            }
        }

        // Initialize application
        async function initApp() {
            try {
                await initAuth0();
                await handleAuth0Callback();
                
                if (auth0Client) {
                    const isAuthenticated = await auth0Client.isAuthenticated();
                    if (isAuthenticated) {
                        const user = await auth0Client.getUser();
                        console.log('×›×‘×¨ ××—×•×‘×¨ ×¢× Auth0:', user);
                        login();
                        currentAuthProvider = 'auth0';
                    }
                }
                
                await refreshDataFromCMS();
                renderCurrentPage();
                
                console.log('××¤×œ×™×§×¦×™×” ××•×ª×—×œ×” ×‘×”×¦×œ×—×”');
                
            } catch (error) {
                console.error('×©×’×™××” ×‘××ª×—×•×œ ×”××¤×œ×™×§×¦×™×”:', error);
                renderCurrentPage();
            }
        }

        // Auto-save data every 5 minutes
        setInterval(async () => {
            if (isLoggedIn) {
                await saveDataToCMS();
            }
        }, 5 * 60 * 1000);

        function openYeshInvoice() {
            window.open('https://www.yeshinvoice.co.il', '_blank');
        }

        // Initialize app when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            initApp();
        });

        // Add search functionality to songs library
        document.addEventListener('DOMContentLoaded', function() {
            const songSearch = document.getElementById('songSearch');
            if (songSearch) {
                songSearch.addEventListener('input', function() {
                    if (currentPage === 'songs-library') {
                        renderSongsLibrary();
                    }
                });
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'963a8a98c25394d7',t:'MTc1MzI2NzAzNS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
